/*
 ==============
 jSignature v2
 Copyright (c) 2012 Willow Systems Corp http://willow-systems.com
 Copyright (c) 2010 Brinley Ang http://www.unbolt.net
 MIT License <http://www.opensource.org/licenses/mit-license.php> 
 ==============
*/
(function(){if(null==this.jQuery)throw Error("We need jQuery for some of the functionality. jQuery is not detected. Failing to initialize...");(function(m){function q(b){for(var a,d=b.css("color"),e;void 0===e&&void 0!==b;){try{a=b.css("background-color")}catch(c){a="transparent"}"transparent"!==a&&"rgba(0, 0, 0, 0)"!==a&&(e=a);try{b=b.parent(),b[0]===document&&(b=void 0)}catch(j){b=void 0}}var b=/rgb[a]*\((\d+),\s*(\d+),\s*(\d+)/,g=/#([AaBbCcDdEeFf\d]{2})([AaBbCcDdEeFf\d]{2})([AaBbCcDdEeFf\d]{2})/,
f;a=void 0;(a=d.match(b))?f={r:parseInt(a[1],10),g:parseInt(a[2],10),b:parseInt(a[3],10)}:(a=d.match(g))&&(f={r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16)});var i;e?(a=void 0,(a=e.match(b))?i={r:parseInt(a[1],10),g:parseInt(a[2],10),b:parseInt(a[3],10)}:(a=e.match(g))&&(i={r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16)})):i=f?127<Math.max.apply(null,[f.r,f.g,f.b])?{r:0,g:0,b:0}:{r:255,g:255,b:255}:{r:255,g:255,b:255};a=function(a){return"rgb("+[a.r,a.g,a.b].join(", ")+
")"};f&&i?(b=Math.max.apply(null,[f.r,f.g,f.b]),f=Math.max.apply(null,[i.r,i.g,i.b]),f=Math.round(f+-0.75*(f-b)),f={r:f,g:f,b:f}):f?(f=Math.max.apply(null,[f.r,f.g,f.b]),b=1,127<f&&(b=-1),f=Math.round(f+96*b),f={r:f,g:f,b:f}):f={r:191,g:191,b:191};return{color:d,"background-color":i?a(i):e,"decor-color":a(f)}}function k(b,a){this.x=b;this.y=a;this.reverse=function(){return new this.constructor(-1*this.x,-1*this.y)};this._length=null;this.getLength=function(){this._length||(this._length=Math.sqrt(Math.pow(this.x,
2)+Math.pow(this.y,2)));return this._length};var d=function(a){return Math.round(a/Math.abs(a))};this.resizeTo=function(a){if(0===this.x&&0===this.y)this._length=0;else if(0===this.x)this._length=a,this.y=a*d(this.y);else if(0===this.y)this._length=a,this.x=a*d(this.x);else{var b=Math.abs(this.y/this.x),c=Math.sqrt(Math.pow(a,2)/(1+Math.pow(b,2))),b=b*c;this._length=a;this.x=c*d(this.x);this.y=b*d(this.y)}return this}}function n(b,a){this.x=b;this.y=a;this.getVectorToCoordinates=function(a,b){return new k(a-
this.x,b-this.y)};this.getVectorFromCoordinates=function(a,b){return this.getVectorToCoordinates(a,b).reverse()};this.getVectorToPoint=function(a){return new k(a.x-this.x,a.y-this.y)};this.getVectorFromPoint=function(a){return this.getVectorToPoint(a).reverse()}}function z(b){this.data=b;this.changed=function(){};this.startStrokeFn=function(){};this.addToStrokeFn=function(){};this.endStrokeFn=function(){};this.inStroke=!1;this._stroke=this._lastPoint=null;this.startStroke=function(a){if(a&&"number"==
typeof a.x&&"number"==typeof a.y){this._stroke={x:[a.x],y:[a.y]};this.data.push(this._stroke);this._lastPoint=a;this.inStroke=!0;var b=this._stroke,c=this.startStrokeFn;setTimeout(function(){c(b)},3);return a}return null};this.addToStroke=function(a){if(this.inStroke&&"number"===typeof a.x&&"number"===typeof a.y&&2<Math.abs(a.x-this._lastPoint.x)+Math.abs(a.y-this._lastPoint.y)){var b=this._stroke.x.length;this._stroke.x.push(a.x);this._stroke.y.push(a.y);this._lastPoint=a;var c=this._stroke,h=this.addToStrokeFn;
setTimeout(function(){h(c,b)},3);return a}return null};this.endStroke=function(){var a=this.inStroke;this.inStroke=!1;this._lastPoint=null;if(a){var b=this.endStrokeFn,c=this._stroke;setTimeout(function(){b(c)},3);setTimeout(this.changed,3);return!0}return null}}function p(b,a){var d=new Image,c=this;d.onload=function(){c.getContext("2d").drawImage(d,0,0,d.width<c.width?d.width:c.width,d.height<c.height?d.height:c.height)};d.src="data:"+a+","+b}function r(b){this.find("canvas."+l).add(this.filter("canvas."+
l)).data(l+".reset")(b);return this}function s(b,a){if(void 0===a&&"string"===typeof b&&"data:"===b.substr(0,5)&&(a=b.slice(5).split(",")[0],b=b.slice(6+a.length),a===b))return;var d=this.find("canvas."+l).add(this.filter("canvas."+l));if(t.hasOwnProperty(a))0!==d.length&&t[a].call(d[0],b,a,d.data(l+".reset"));else throw Error(l+" is unable to find import plugin with for format '"+(""+a)+"'");return this}var l="jSignature",u=function(b){var a={width:"max",height:"max",sizeRatio:4,color:"#000","background-color":"#fff",
"decor-color":"#eee",lineWidth:0},d=m(this);m.extend(a,q(d));b&&m.extend(a,b);if("max"==a.width||"max"==a.height){var b=d.width(),c=d.height();b/a.sizeRatio>c&&(c=parseInt(b/a.sizeRatio,10));a.width=b;a.height=c}0==a.lineWidth&&(b=parseInt(a.width,10),b=parseInt(b/300,10),a.lineWidth=2>b?2:b);var h=1E3>parseInt(a.width,10)?!0:!1,j=d.find("canvas"),g;j.length?g=j.get(0):(g=document.createElement("canvas"),g.width=a.width,g.height=a.height,j=m(g),j.appendTo(d));j.addClass(l);var f=function(){var a=
1;if(g.getContext)return false;if(typeof FlashCanvas!=="undefined"){window&&window.screen&&window.screen.deviceXDPI&&window.screen.logicalXDPI&&(a=window.screen.deviceXDPI*1/window.screen.logicalXDPI);g=FlashCanvas.initElement(g);if(a!==1){j.children("object").get(0).resize(Math.ceil(g.width*a),Math.ceil(g.height*a));g.getContext("2d").scale(a,a)}return true}throw Error("Canvas element does not support 2d context. "+l+" cannot proceed.");}();g.onselectstart=function(a){a&&a.preventDefault&&a.preventDefault();
a&&a.stopPropagation&&a.stopPropagation();return false};a.cssclass&&""!=m.trim(a.cssclass)&&j.addClass(a.cssclass);var i=g.getContext("2d"),v,A,t,o,p,r,E=-1*Math.round(a.lineWidth/2),s=function(a,b,d,c){i.beginPath();i.moveTo(a,b);i.lineTo(d,c);i.stroke()},b=function(b){var c=g.width,e=g.height;i.clearRect(0,0,c+30,e+30);i.shadowColor=i.fillStyle=a["background-color"];f&&i.fillRect(0,0,c+30,e+30);i.lineWidth=Math.ceil(parseInt(a.lineWidth,10));i.lineCap=i.lineJoin="round";var k=Math.round(e/5);i.strokeStyle=
a["decor-color"];i.shadowOffsetX=0;i.shadowOffsetY=0;s(k*1.5,e-k,c-k*1.5,e-k);i.strokeStyle=a.color;if(!f&&!h){i.shadowColor=i.strokeStyle;i.shadowOffsetX=i.lineWidth*0.5;i.shadowOffsetY=i.lineWidth*-0.6;i.shadowBlur=0}if(b===void 0)b=[];else for(var c=b.length,m=0;m<c;m++){e=b[m];k=e.x.length;A(e);for(var n=1;n<k;n++)t(e,n);o(e)}v=new z(b);v.startStrokeFn=A;v.addToStrokeFn=t;v.endStrokeFn=o;v.changed=function(){d.trigger("change")};j.data(l+".data",b);return true},B=null,w=function(a){try{a.preventDefault()}catch(b){}clearTimeout(B);
v.endStroke()},F=0,G=function(a){a=a.changedTouches&&a.changedTouches.length>0?a.changedTouches[0]:a;return new n(Math.round(a.pageX+p),Math.round(a.pageY+r)+F)},u=function(a){a.preventDefault();var b=j.offset();p=b.left*-1;r=b.top*-1;v.startStroke(G(a));clearTimeout(B);B=setTimeout(w,750)},C=function(a){a.preventDefault();if(v.inStroke&&v.addToStroke(G(a))){clearTimeout(B);B=setTimeout(w,750)}},D=3*a.lineWidth;A=function(b){var c=b.x[0],b=b.y[0];i.fillStyle=a.color;i.fillRect(c+E,b+E,a.lineWidth,
a.lineWidth);i.fillStyle=a["background-color"]};t=function(a,b){var c=new n(a.x[b-1],a.y[b-1]),d=new n(a.x[b],a.y[b]),e=c.getVectorToPoint(d);if(b>1){var f=new n(a.x[b-2],a.y[b-2]),g=f.getVectorToPoint(c),h;if(g.getLength()>D){h=b>2?(new n(a.x[b-3],a.y[b-3])).getVectorToPoint(f):new k(0,0);var j=g.getLength()*0.35,l=(new k(h.x+g.x,h.y+g.y)).resizeTo(j),v=(new k(g.x+e.x,g.y+e.y)).reverse().resizeTo(j),g=f.x,j=f.y;h=c.x;var m=c.y,A=f.x+l.x,f=f.y+l.y,l=c.x+v.x,v=c.y+v.y;i.beginPath();i.moveTo(g,j);i.bezierCurveTo(A,
f,l,v,h,m);i.stroke()}}e.getLength()<=D&&s(c.x,c.y,d.x,d.y)};o=function(a){var b=a.x.length-1;if(b>0){var c=new n(a.x[b],a.y[b]),d=new n(a.x[b-1],a.y[b-1]),e=d.getVectorToPoint(c);if(e.getLength()>D)if(b>1){var a=(new n(a.x[b-2],a.y[b-2])).getVectorToPoint(d),f=(new k(a.x+e.x,a.y+e.y)).resizeTo(e.getLength()/2),e=d.x,a=d.y,b=c.x,g=c.y,h=d.x+f.x,d=d.y+f.y,f=c.x,c=c.y;i.beginPath();i.moveTo(e,a);i.bezierCurveTo(h,d,f,c,b,g);i.stroke()}else s(d.x,d.y,c.x,c.y)}};f?j.bind("mousedown."+l,function(a){j.unbind("mousedown."+
l);u(a);j.bind("mousemove."+l,C);j.bind("mouseup."+l,w);j.bind("mousedown."+l,u)}):(g.ontouchstart=function(b){g.onmousedown=null;g.onmouseup=null;g.onmousemove=null;F=a.lineWidth*-5<-15?a.lineWidth*-5:-15;u(b);g.ontouchend=w;g.ontouchstart=u;g.ontouchmove=C},g.onmousedown=function(a){g.ontouchstart=null;g.ontouchend=null;g.ontouchmove=null;u(a);g.onmousedown=u;g.onmouseup=w;g.onmousemove=C});j.data(l+".reset",b);m(document).bind("mouseup."+l,w);b(a.data)},o={"default":function(){return this.toDataURL()},
"native":function(b){return b},image:function(){var b=this.toDataURL();if("string"===typeof b&&4<b.length&&"data:"===b.slice(0,5)&&-1!==b.indexOf(",")){var a=b.indexOf(",");return[b.slice(5,a),b.substr(a+1)]}return[]}},t={"native":function(b,a,c){c(b)},image:p,"image/png;base64":p,"image/jpeg;base64":p,"image/jpg;base64":p},c={init:function(b){return this.each(function(){u.call(this,b)})},clear:r,reset:r,addPlugin:function(b,a,c){var e={"export":o,"import":t};e.hasOwnProperty(b)&&(e[b][a]=c);return this},
listPlugins:function(b){var a={"export":o,"import":t},c=[];if(a.hasOwnProperty(b)){var b=a[b],e;for(e in b)b.hasOwnProperty(e)&&c.push(e)}return c},getData:function(b){var a=this.find("canvas."+l).add(this.filter("canvas."+l));void 0===b&&(b="default");if(0!==a.length&&o.hasOwnProperty(b))return o[b].call(a.get(0),a.data(l+".data"))},importData:s,setData:s};m.fn[l]=function(b){if(c[b])return c[b].apply(this,Array.prototype.slice.call(arguments,1));if("object"===typeof b||!b)return c.init.apply(this,
arguments);m.error("Method "+b+" does not exist on jQuery."+l)};return m})(this.jQuery)})("undefined"!==typeof window?window:this);/*

 ==============
 jSignature v2 jSignature's custom "base30" format export and import plugins.
 Copyright (c) 2011 Willow Systems Corp http://willow-systems.com
 MIT License <http://www.opensource.org/licenses/mit-license.php>
 ==============
*/
(function(){for(var m={},q={},k="0,1,2,3,4,5,6,7,8,9,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X".split(","),n=k.length/2,z=n-1;-1<z;z--)m[k[z]]=k[z+n],q[k[z+n]]=k[z];var p=function(c){for(var c=c.split(""),b=c.length,a=1;a<b;a++)c[a]=m[c[a]];return c.join("")},r=function(c){for(var b=[],a=0,d=1,e=c.length,h,j,g=0;g<e;g++)h=c[g],j=h-a,a=h,0>j&&0<d?(d=-1,b.push("Z")):0<j&&0>d&&(d=1,b.push("Y")),h=Math.abs(j),h>=n?b.push(p(h.toString(n))):b.push(h.toString(n));
return b.join("")},s=function(c){for(var b=[],c=c.split(""),a=c.length,d,e=1,h=[],j=0,g=0;g<a;g++)(d=c[g],d in m||"Z"===d||"Y"===d)?(0!==h.length&&(h=parseInt(h.join(""),n)*e+j,b.push(h),j=h),"Z"===d)?(e=-1,h=[]):"Y"===d?(e=1,h=[]):h=[d]:h.push(q[d]);b.push(parseInt(h.join(""),n)*e+j);return b},l=function(c){for(var b=[],a=c.length,d,e=0;e<a;e++)d=c[e],b.push(r(d.x)),b.push(r(d.y));return b.join("_")},u=function(c){for(var b=[],c=c.split("_"),a=c.length/2,d=0;d<a;d++)b.push({x:s(c[2*d]),y:s(c[2*d+
1])});return b},o=function(c){return["image/jsignature;base30",l(c)]},t=function(c,b,a){"string"===typeof c&&("image/jsignature;base30"===c.substring(0,23).toLowerCase()&&(c=c.substring(24)),a(u(c)))};if(null==this.jQuery)throw Error("We need jQuery for some of the functionality. jQuery is not detected. Failing to initialize...");(function(c){c=c.fn.jSignature;c("addPlugin","export","base30",o);c("addPlugin","export","image/jsignature;base30",o);c("addPlugin","import","base30",t);c("addPlugin","import",
"image/jsignature;base30",t)})(this.jQuery);this.jSignatureDebug&&(this.jSignatureDebug.base30={remapTailChars:p,compressstrokeleg:r,uncompressstrokeleg:s,compressstrokes:l,uncompressstrokes:u,charmap:m})}).call("undefined"!==typeof window?window:this);/*

 ==============
 Simplify.js BSD 
 (c) 2012, Vladimir Agafonkin
 mourner.github.com/simplify-js
 ==============

 ====================================================================
 base64 encoder
 MIT, GPL

 version: 1109.2015
 discuss at: http://phpjs.org/functions/base64_encode
 +   original by: Tyler Akins (http://rumkin.com)
 +   improved by: Bayron Guevara
 +   improved by: Thunder.m
 +   improved by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)
 +   bugfixed by: Pellentesque Malesuada
 +   improved by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)
 +   improved by: Rafal Kukawski (http://kukawski.pl)
 ====================================================================

 ==============
 jSignature v2 SVG export plugin.
 Copyright (c) 2012 Willow Systems Corp http://willow-systems.com
 MIT License <http://www.opensource.org/licenses/mit-license.php>
 ============== 
*/
(function(){function m(c,b){this.x=c;this.y=b;this.reverse=function(){return new this.constructor(-1*this.x,-1*this.y)};this._length=null;this.getLength=function(){this._length||(this._length=Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)));return this._length};var a=function(a){return Math.round(a/Math.abs(a))};this.resizeTo=function(b){if(0===this.x&&0===this.y)this._length=0;else if(0===this.x)this._length=b,this.y=b*a(this.y);else if(0===this.y)this._length=b,this.x=b*a(this.x);else{var c=Math.abs(this.y/
this.x),h=Math.sqrt(Math.pow(b,2)/(1+Math.pow(c,2))),c=c*h;this._length=b;this.x=h*a(this.x);this.y=c*a(this.y)}return this};this.angleTo=function(a){var b=this.getLength()*a.getLength();return 0===b?0:Math.acos(Math.min(Math.max((this.x*a.x+this.y*a.y)/b,-1),1))/Math.PI}}function q(c,b){this.x=c;this.y=b;this.getVectorToCoordinates=function(a,b){return new m(a-this.x,b-this.y)};this.getVectorFromCoordinates=function(a,b){return this.getVectorToCoordinates(a,b).reverse()};this.getVectorToPoint=function(a){return new m(a.x-
this.x,a.y-this.y)};this.getVectorFromPoint=function(a){return this.getVectorToPoint(a).reverse()}}function k(c,b){var a=Math.pow(10,b);return Math.round(c*a)/a}function n(c,b,a){var b=b+1,d=new q(c.x[b-1],c.y[b-1]),e=new q(c.x[b],c.y[b]),e=d.getVectorToPoint(e),h=new q(c.x[b-2],c.y[b-2]),d=h.getVectorToPoint(d);return d.getLength()>a?(a=2<b?(new q(c.x[b-3],c.y[b-3])).getVectorToPoint(h):new m(0,0),c=0.35*d.getLength(),h=d.angleTo(a.reverse()),b=e.angleTo(d.reverse()),a=(new m(a.x+d.x,a.y+d.y)).resizeTo(Math.max(0.05,
h)*c),e=(new m(d.x+e.x,d.y+e.y)).reverse().resizeTo(Math.max(0.05,b)*c),e=new m(d.x+e.x,d.y+e.y),["c",k(a.x,2),k(a.y,2),k(e.x,2),k(e.y,2),k(d.x,2),k(d.y,2)]):["l",k(d.x,2),k(d.y,2)]}function z(c,b){var a=c.x.length-1,d=new q(c.x[a],c.y[a]),e=new q(c.x[a-1],c.y[a-1]),d=e.getVectorToPoint(d);if(1<a&&d.getLength()>b){var a=(new q(c.x[a-2],c.y[a-2])).getVectorToPoint(e),e=d.angleTo(a.reverse()),h=0.35*d.getLength(),a=(new m(a.x+d.x,a.y+d.y)).resizeTo(Math.max(0.05,e)*h);return["c",k(a.x,2),k(a.y,2),k(d.x,
2),k(d.y,2),k(d.x,2),k(d.y,2)]}return["l",k(d.x,2),k(d.y,2)]}function p(c,b,a){for(var b=["M",x=c.x[0]-b,y=c.y[0]-a],a=1,d=c.x.length-1;a<d;a++)b.push.apply(b,n(c,a,1));0<d&&b.push.apply(b,z(c,a,1));return b.join(" ")}function r(c){var b=['<?xml version="1.0" encoding="UTF-8" standalone="no"?>','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">'],a,d=c.length,e,h=[],j=[],g=e=a=0,f=0,i=[];if(0!==d){for(a=0;a<d;a++){g=c[a];f=[];e={x:[],y:[]};for(var k=
void 0,l=void 0,k=0,l=g.x.length;k<l;k++)f.push({x:g.x[k],y:g.y[k]});f=simplify(f,0.7,!0);k=0;for(l=f.length;k<l;k++)e.x.push(f[k].x),e.y.push(f[k].y);i.push(e);h=h.concat(e.x);j=j.concat(e.y)}c=Math.min.apply(null,h)-1;d=Math.max.apply(null,h)+1;h=Math.min.apply(null,j)-1;j=Math.max.apply(null,j)+1;g=0>c?0:c;f=0>h?0:h;a=d-c;e=j-h}b.push('<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="'+a.toString()+'" height="'+e.toString()+'">');a=0;for(d=i.length;a<d;a++)e=i[a],b.push('<path fill="none" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="'+
p(e,g,f)+'"/>');b.push("</svg>");return b.join("")}function s(c){return[o,r(c)]}function l(c){return[t,u(r(c))]}(function(c,b){"use strict";(typeof exports!=b+""?exports:c).simplify=function(a,c,e){c=c!==b?c*c:1;if(!e){for(var h=a.length,j,g=a[0],f=[g],e=1;e<h;e++){j=a[e];var i=j.x-g.x,k=j.y-g.y;i*i+k*k>c&&(f.push(j),g=j)}a=(g!==j&&f.push(j),f)}j=a;var e=j.length,h=new (typeof Uint8Array!=b+""?Uint8Array:Array)(e),g=0,f=e-1,l,m,n=[],t=[],u=[];for(h[g]=h[f]=1;f;){k=0;for(i=g+1;i<f;i++){l=j[i];var o=
j[g],s=j[f],q=o.x,w=o.y,o=s.x-q,p=s.y-w,r=void 0;if(0!==o||0!==p)r=((l.x-q)*o+(l.y-w)*p)/(o*o+p*p),1<r?(q=s.x,w=s.y):0<r&&(q+=o*r,w+=p*r);l=(o=l.x-q,p=l.y-w,o*o+p*p);l>k&&(m=i,k=l)}k>c&&(h[m]=1,n.push(g),t.push(m),n.push(m),t.push(f));g=n.pop();f=t.pop()}for(i=0;i<e;i++)h[i]&&u.push(j[i]);return a=u,a}})(this);if("function"!==typeof u)var u=function(c){var b="A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,0,1,2,3,4,5,6,7,8,9,+,/,=".split(","),
a,d,e,h,j=0,g=0,f="",f=[];do a=c.charCodeAt(j++),d=c.charCodeAt(j++),e=c.charCodeAt(j++),h=a<<16|d<<8|e,a=h>>18&63,d=h>>12&63,e=h>>6&63,h&=63,f[g++]=b[a]+b[d]+b[e]+b[h];while(j<c.length);f=f.join("");c=c.length%3;return(c?f.slice(0,c-3):f)+"===".slice(c||3)};var o="image/svg+xml",t="image/svg+xml;base64";if(null==this.jQuery)throw Error("We need jQuery for some of the functionality. jQuery is not detected. Failing to initialize...");(function(c){c=c.fn.jSignature;c("addPlugin","export","svg",s);c("addPlugin",
"export",o,s);c("addPlugin","export","svgbase64",l);c("addPlugin","export",t,l)})(this.jQuery)}).call("undefined"!==typeof window?window:this);
