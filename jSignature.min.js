/*

jSignature v2
Copyright (c) 2012 Willow Systems Corp http://willow-systems.com
Copyright (c) 2010 Brinley Ang http://www.unbolt.net
MIT License <http://www.opensource.org/licenses/mit-license.php> 


jSignature v2 jSignature's Undo Button and undo functionality plugin
Copyright (c) 2011 Willow Systems Corp http://willow-systems.com
MIT License <http://www.opensource.org/licenses/mit-license.php>


jSignature v2 jSignature's custom "base30" format export and import plugins.
Copyright (c) 2011 Willow Systems Corp http://willow-systems.com
MIT License <http://www.opensource.org/licenses/mit-license.php>


Simplify.js BSD 
(c) 2012, Vladimir Agafonkin
mourner.github.com/simplify-js


base64 encoder
MIT, GPL
http://phpjs.org/functions/base64_encode
+   original by: Tyler Akins (http://rumkin.com)
+   improved by: Bayron Guevara
+   improved by: Thunder.m
+   improved by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)
+   bugfixed by: Pellentesque Malesuada
+   improved by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)
+   improved by: Rafal Kukawski (http://kukawski.pl)


jSignature v2 SVG export plugin.
Copyright (c) 2012 Willow Systems Corp http://willow-systems.com
MIT License <http://www.opensource.org/licenses/mit-license.php>

*/
(function(k){function q(b){for(var j,p=b.css("color"),h,b=b[0],c=!1;b&&!h&&!c;){try{j=k(b).css("background-color")}catch(d){j="transparent"}"transparent"!==j&&"rgba(0, 0, 0, 0)"!==j&&(h=j);c=b.body;b=b.parentNode}var b=/rgb[a]*\((\d+),\s*(\d+),\s*(\d+)/,c=/#([AaBbCcDdEeFf\d]{2})([AaBbCcDdEeFf\d]{2})([AaBbCcDdEeFf\d]{2})/,a;j=void 0;(j=p.match(b))?a={r:parseInt(j[1],10),g:parseInt(j[2],10),b:parseInt(j[3],10)}:(j=p.match(c))&&(a={r:parseInt(j[1],16),g:parseInt(j[2],16),b:parseInt(j[3],16)});var f;
h?(j=void 0,(j=h.match(b))?f={r:parseInt(j[1],10),g:parseInt(j[2],10),b:parseInt(j[3],10)}:(j=h.match(c))&&(f={r:parseInt(j[1],16),g:parseInt(j[2],16),b:parseInt(j[3],16)})):f=a?127<Math.max.apply(null,[a.r,a.g,a.b])?{r:0,g:0,b:0}:{r:255,g:255,b:255}:{r:255,g:255,b:255};j=function(b){return"rgb("+[b.r,b.g,b.b].join(", ")+")"};a&&f?(b=Math.max.apply(null,[a.r,a.g,a.b]),a=Math.max.apply(null,[f.r,f.g,f.b]),a=Math.round(a+-0.75*(a-b)),a={r:a,g:a,b:a}):a?(a=Math.max.apply(null,[a.r,a.g,a.b]),b=1,127<
a&&(b=-1),a=Math.round(a+96*b),a={r:a,g:a,b:a}):a={r:191,g:191,b:191};return{color:p,"background-color":f?j(f):h,"decor-color":j(a)}}function g(b,j){this.x=b;this.y=j;this.reverse=function(){return new this.constructor(-1*this.x,-1*this.y)};this._length=null;this.getLength=function(){this._length||(this._length=Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)));return this._length};var p=function(b){return Math.round(b/Math.abs(b))};this.resizeTo=function(b){if(0===this.x&&0===this.y)this._length=
0;else if(0===this.x)this._length=b,this.y=b*p(this.y);else if(0===this.y)this._length=b,this.x=b*p(this.x);else{var j=Math.abs(this.y/this.x),a=Math.sqrt(Math.pow(b,2)/(1+Math.pow(j,2))),j=j*a;this._length=b;this.x=a*p(this.x);this.y=j*p(this.y)}return this};this.angleTo=function(b){var j=this.getLength()*b.getLength();return 0===j?0:Math.acos(Math.min(Math.max((this.x*b.x+this.y*b.y)/j,-1),1))/Math.PI}}function n(b,j){this.x=b;this.y=j;this.getVectorToCoordinates=function(b,j){return new g(b-this.x,
j-this.y)};this.getVectorFromCoordinates=function(b,j){return this.getVectorToCoordinates(b,j).reverse()};this.getVectorToPoint=function(b){return new g(b.x-this.x,b.y-this.y)};this.getVectorFromPoint=function(b){return this.getVectorToPoint(b).reverse()}}function r(b,j,a,h,c){this.data=b;this.context=j;if(b.length)for(var d=b.length,f,m,i=0;i<d;i++){f=b[i];m=f.x.length;a.call(j,f);for(var e=1;e<m;e++)h.call(j,f,e);c.call(j,f)}this.changed=function(){};this.startStrokeFn=a;this.addToStrokeFn=h;this.endStrokeFn=
c;this.inStroke=!1;this._stroke=this._lastPoint=null;this.startStroke=function(b){if(b&&"number"==typeof b.x&&"number"==typeof b.y){this._stroke={x:[b.x],y:[b.y]};this.data.push(this._stroke);this._lastPoint=b;this.inStroke=!0;var j=this._stroke,a=this.startStrokeFn,h=this.context;setTimeout(function(){a.call(h,j)},3);return b}return null};this.addToStroke=function(b){if(this.inStroke&&"number"===typeof b.x&&"number"===typeof b.y&&4<Math.abs(b.x-this._lastPoint.x)+Math.abs(b.y-this._lastPoint.y)){var j=
this._stroke.x.length;this._stroke.x.push(b.x);this._stroke.y.push(b.y);this._lastPoint=b;var a=this._stroke,h=this.addToStrokeFn,p=this.context;setTimeout(function(){h.call(p,a,j)},3);return b}return null};this.endStroke=function(){var b=this.inStroke;this.inStroke=!1;this._lastPoint=null;if(b){var j=this._stroke,a=this.endStrokeFn,h=this.context,p=this.changed;setTimeout(function(){a.call(h,j);p.call(h)},3);return!0}return null}}function s(b,j,a){var h=this.$parent=k(b),b=this.eventTokens={};this.events=
new v(this);var c=k.fn[e]("globalEvents"),d={width:"ratio",height:"ratio",sizeRatio:4,color:"#000","background-color":"#fff","decor-color":"#eee",lineWidth:0,minFatFingerCompensation:-10,showUndoButton:!1,data:[]};k.extend(d,q(h));j&&k.extend(d,j);this.settings=d;for(var f in a)a.hasOwnProperty(f)&&a[f].call(this,f);this.events.publish(e+".initializing");this.$controlbarUpper=k('<div style="padding:0 !important;margin:0 !important;width: 100% !important; height: 0 !important;margin-top:-1em !important;margin-bottom:1em !important;"></div>').appendTo(h);
this.isCanvasEmulator=!1;a=this.canvas=this.initializeCanvas(d);j=k(a);this.$controlbarLower=k('<div style="padding:0 !important;margin:0 !important;width: 100% !important; height: 0 !important;margin-top:-1.5em !important;margin-bottom:1.5em !important;"></div>').appendTo(h);this.canvasContext=a.getContext("2d");j.data(e+".this",this);h=(h=d.lineWidth)?h:Math.max(Math.round(a.width/400),2);d.lineWidth=h;this.lineCurveThreshold=3*d.lineWidth;d.cssclass&&""!=k.trim(d.cssclass)&&j.addClass(d.cssclass);
this.fatFingerCompensation=0;var h=function(b){var j,a,h=function(h){h=h.changedTouches&&0<h.changedTouches.length?h.changedTouches[0]:h;return new n(Math.round(h.pageX+j),Math.round(h.pageY+a)+b.fatFingerCompensation)},d=new x(750,function(){b.dataEngine.endStroke()});this.drawEndHandler=function(j){try{j.preventDefault()}catch(a){}d.clear();b.dataEngine.endStroke()};this.drawStartHandler=function(c){c.preventDefault();var p=k(b.canvas).offset();j=-1*p.left;a=-1*p.top;b.dataEngine.startStroke(h(c));
d.kick()};this.drawMoveHandler=function(j){j.preventDefault();b.dataEngine.inStroke&&(b.dataEngine.addToStroke(h(j)),d.kick())};return this}.call({},this),m=h.drawEndHandler,i=h.drawStartHandler,g=h.drawMoveHandler,l=this.canvas,j=k(l);this.isCanvasEmulator?(j.bind("mousemove."+e,g),j.bind("mouseup."+e,m),j.bind("mousedown."+e,i)):(l.ontouchstart=function(b){l.onmousedown=void 0;l.onmouseup=void 0;l.onmousemove=void 0;this.fatFingerCompensation=d.minFatFingerCompensation&&-3*d.lineWidth>d.minFatFingerCompensation?
-3*d.lineWidth:d.minFatFingerCompensation;i(b);l.ontouchend=m;l.ontouchstart=i;l.ontouchmove=g},l.onmousedown=function(b){l.ontouchstart=void 0;l.ontouchend=void 0;l.ontouchmove=void 0;i(b);l.onmousedown=i;l.onmouseup=m;l.onmousemove=g});b[e+".windowmouseup"]=c.subscribe(e+".windowmouseup",h.drawEndHandler);this.events.publish(e+".attachingEventHandlers");var o=this,b=d.width.toString(10),w=e;if("ratio"===b||"%"===b.split("")[b.length-1])this.eventTokens[w+".parentresized"]=c.subscribe(w+".parentresized",
function(b,j,a){return function(){var h=j.width();if(h!==a){for(var d in b)if(b.hasOwnProperty(d)){c.unsubscribe(b[d]);delete b[d]}var p=o.settings;o.$parent.children().remove();for(d in o)o.hasOwnProperty(d)&&delete o[d];d=p.data;var h=h*1/a,f=[],m,i,l,e,g,k;i=0;for(l=d.length;i<l;i++){k=d[i];m={x:[],y:[]};e=0;for(g=k.x.length;e<g;e++){m.x.push(k.x[e]*h);m.y.push(k.y[e]*h)}f.push(m)}p.data=f;j[w](p)}}}(this.eventTokens,this.$parent,this.$parent.width(),1*this.canvas.width/this.canvas.height));this.resetCanvas(d.data);
this.events.publish(e+".initialized");return this}var e="jSignature",x=function(b,j){var a;this.kick=function(){clearTimeout(a);a=setTimeout(j,b)};this.clear=function(){clearTimeout(a)};return this},v=function(b){this.topics={};this.context=b?b:this;this.publish=function(b,a,h,d){if(this.topics[b]){var c=this.topics[b],f=Array.prototype.slice.call(arguments,1),m=[],i,l,e,g;l=0;for(e=c.length;l<e;l++)g=c[l],i=g[0],g[1]&&(g[0]=function(){},m.push(l)),i.apply(this.context,f);l=0;for(e=m.length;l<e;l++)c.splice(m[l],
1)}};this.subscribe=function(b,a,h){this.topics[b]?this.topics[b].push([a,h]):this.topics[b]=[[a,h]];return{topic:b,callback:a}};this.unsubscribe=function(b){if(this.topics[b.topic])for(var a=this.topics[b.topic],h=0,d=a.length;h<d;h++)a[h][0]===b.callback&&a.splice(h,1)}},t=function(b){var a=this.canvasContext,d=b.x[0],b=b.y[0],h=this.settings.lineWidth,c=a.fillStyle;a.fillStyle=a.strokeStyle;a.fillRect(d+h/-2,b+h/-2,h,h);a.fillStyle=c},u=function(b,a){var d=new n(b.x[a-1],b.y[a-1]),h=new n(b.x[a],
b.y[a]),c=d.getVectorToPoint(h);if(1<a){var f=new n(b.x[a-2],b.y[a-2]),m=f.getVectorToPoint(d),i;if(m.getLength()>this.lineCurveThreshold){i=2<a?(new n(b.x[a-3],b.y[a-3])).getVectorToPoint(f):new g(0,0);var l=0.35*m.getLength(),e=m.angleTo(i.reverse()),k=c.angleTo(m.reverse());i=(new g(i.x+m.x,i.y+m.y)).resizeTo(Math.max(0.05,e)*l);var o=(new g(m.x+c.x,m.y+c.y)).reverse().resizeTo(Math.max(0.05,k)*l),m=this.canvasContext,l=f.x,k=f.y,e=d.x,w=d.y,y=f.x+i.x,f=f.y+i.y;i=d.x+o.x;o=d.y+o.y;m.beginPath();
m.moveTo(l,k);m.bezierCurveTo(y,f,i,o,e,w);m.stroke()}}c.getLength()<=this.lineCurveThreshold&&(c=this.canvasContext,f=d.x,d=d.y,i=h.x,h=h.y,c.beginPath(),c.moveTo(f,d),c.lineTo(i,h),c.stroke())},l=function(b){var a=b.x.length-1;if(0<a){var d=new n(b.x[a],b.y[a]),h=new n(b.x[a-1],b.y[a-1]),c=h.getVectorToPoint(d);if(c.getLength()>this.lineCurveThreshold){if(1<a){var b=(new n(b.x[a-2],b.y[a-2])).getVectorToPoint(h),f=(new g(b.x+c.x,b.y+c.y)).resizeTo(c.getLength()/2),c=this.canvasContext,b=h.x,a=h.y,
m=d.x,i=d.y,l=h.x+f.x,h=h.y+f.y,f=d.x,d=d.y;c.beginPath();c.moveTo(b,a);c.bezierCurveTo(l,h,f,d,m,i)}else c=this.canvasContext,b=h.x,h=h.y,a=d.x,d=d.y,c.beginPath(),c.moveTo(b,h),c.lineTo(a,d);c.stroke()}}};s.prototype.resetCanvas=function(b){var a=this.canvas,d=this.settings,c=this.canvasContext,f=this.isCanvasEmulator,m=a.width,i=a.height;c.clearRect(0,0,m+30,i+30);c.shadowColor=c.fillStyle=d["background-color"];f&&c.fillRect(0,0,m+30,i+30);c.lineWidth=Math.ceil(parseInt(d.lineWidth,10));c.lineCap=
c.lineJoin="round";c.strokeStyle=d["decor-color"];c.shadowOffsetX=0;c.shadowOffsetY=0;var g=Math.round(i/5),o=1.5*g,w=i-g,m=m-1.5*g,i=i-g;c.beginPath();c.moveTo(o,w);c.lineTo(m,i);c.stroke();c.strokeStyle=d.color;f||(c.shadowColor=c.strokeStyle,c.shadowOffsetX=0.5*c.lineWidth,c.shadowOffsetY=-0.6*c.lineWidth,c.shadowBlur=0);b||(b=[]);c=this.dataEngine=new r(b,this,t,u,l);d.data=b;k(a).data(e+".data",b).data(e+".settings",d);var y=this.$parent,z=this.events,n=e;c.changed=function(){z.publish(n+".change");
y.trigger("change")};c.changed();return!0};s.prototype.initializeCanvas=function(b){var a=document.createElement("canvas"),c=k(a);b.width===b.height&&"ratio"===b.height&&(b.width="100%");c.css("margin",0).css("padding",0).css("border","none").css("height","ratio"===b.height||!b.height?1:b.height.toString(10)).css("width","ratio"===b.width||!b.width?1:b.width.toString(10));c.appendTo(this.$parent);"ratio"===b.height?c.css("height",Math.round(c.width()/b.sizeRatio)):"ratio"===b.width&&c.css("width",
Math.round(c.height()*b.sizeRatio));c.addClass(e);a.width=c.width();a.height=c.height();b=a;if(b.getContext)b=!1;else if("undefined"!==typeof FlashCanvas)b=FlashCanvas.initElement(b),c=1,window&&(window.screen&&window.screen.deviceXDPI&&window.screen.logicalXDPI)&&(c=1*window.screen.deviceXDPI/window.screen.logicalXDPI),1!==c&&(k(b).children("object").get(0).resize(Math.ceil(b.width*c),Math.ceil(b.height*c)),b.getContext("2d").scale(c,c)),b=!0;else throw Error("Canvas element does not support 2d context. jSignature cannot proceed.");
this.isCanvasEmulator=b;a.onselectstart=function(b){b&&b.preventDefault&&b.preventDefault();b&&b.stopPropagation&&b.stopPropagation();return false};return a};var o=function(b,a){var c=new Image,d=this;c.onload=function(){d.getContext("2d").drawImage(c,0,0,c.width<d.width?c.width:d.width,c.height<d.height?c.height:d.height)};c.src="data:"+a+","+b},a=function(b){this.find("canvas."+e).add(this.filter("canvas."+e)).data(e+".this").resetCanvas(b);return this},f=function(b,a){if(void 0===a&&("string"===
typeof b&&"data:"===b.substr(0,5))&&(a=b.slice(5).split(",")[0],b=b.slice(6+a.length),a===b))return;var c=this.find("canvas."+e).add(this.filter("canvas."+e));if(w.hasOwnProperty(a))0!==c.length&&w[a].call(c[0],b,a,function(b){return function(){return b.resetCanvas.apply(b,arguments)}}(c.data(e+".this")));else throw Error(e+" is unable to find import plugin with for format '"+String(a)+"'");return this},d=new v,c=e,m,i=function(){d.publish(c+".parentresized")};k(window).bind("resize."+c,function(){m&&
clearTimeout(m);m=setTimeout(i,500)}).bind("mouseup."+c,function(b){d.publish(c+".windowmouseup",b)});var y={},z={"default":function(){return this.toDataURL()},"native":function(b){return b},image:function(){var b=this.toDataURL();if("string"===typeof b&&4<b.length&&"data:"===b.slice(0,5)&&-1!==b.indexOf(",")){var a=b.indexOf(",");return[b.slice(5,a),b.substr(a+1)]}return[]}},w={"native":function(b,a,c){c(b)},image:o,"image/png;base64":o,"image/jpeg;base64":o,"image/jpg;base64":o},A={"export":z,"import":w,
instance:y},B={init:function(b){return this.each(function(){var a,c=!1;for(a=this.parentNode;a&&!c;)c=a.body,a=a.parentNode;!c||new s(this,b,y)})},getSettings:function(){return this.find("canvas."+e).add(this.filter("canvas."+e)).data(e+".this").settings},clear:a,reset:a,addPlugin:function(b,a,c){A.hasOwnProperty(b)&&(A[b][a]=c);return this},listPlugins:function(b){var a=[];if(A.hasOwnProperty(b)){var b=A[b],c;for(c in b)b.hasOwnProperty(c)&&a.push(c)}return a},getData:function(b){var a=this.find("canvas."+
e).add(this.filter("canvas."+e));void 0===b&&(b="default");if(0!==a.length&&z.hasOwnProperty(b))return z[b].call(a.get(0),a.data(e+".data"))},importData:f,setData:f,globalEvents:function(){return d},events:function(){return this.find("canvas."+e).add(this.filter("canvas."+e)).data(e+".this").events}};k.fn[e]=function(b){if(!b||"object"===typeof b)return B.init.apply(this,arguments);if("string"===typeof b&&B[b])return B[b].apply(this,Array.prototype.slice.call(arguments,1));k.error("Method "+String(b)+
" does not exist on jQuery."+e)}})(jQuery);
(function(k){k.fn.jSignature("addPlugin","instance","UndoButton",function(q){this.events.subscribe("jSignature.attachingEventHandlers",function(){if(this.settings[q]){var g=this.settings[q];"function"!==typeof g&&(g=function(){var e=k('<input type="button" value="Undo last stroke" style="position:absolute;display:none;margin:0 !important;top:auto" />').appendTo(this.$controlbarLower),g=e.width();e.css("left",Math.round((this.canvas.width-g)/2));g!==e.width()&&e.width(g);return e});var n=g.call(this),
r=this;r.events.subscribe("jSignature.change",function(){r.dataEngine.data.length?n.show():n.hide()});var s=this,e=(this.events.topics.hasOwnProperty("jSignature.undo")?q:"jSignature")+".undo";n.bind("click",function(){s.events.publish(e)});s.events.subscribe(e,function(){var e=s.dataEngine.data;e.length&&(e.pop(),s.resetCanvas(e))})}})})})(jQuery);
(function(){for(var k={},q={},g="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWX".split(""),n=g.length/2,r=n-1;-1<r;r--)k[g[r]]=g[r+n],q[g[r+n]]=g[r];var s=function(e){for(var e=e.split(""),g=e.length,a=1;a<g;a++)e[a]=k[e[a]];return e.join("")},e=function(e){for(var g=[],a=0,f=1,d=e.length,c,m,i=0;i<d;i++)c=Math.round(e[i]),m=c-a,a=c,0>m&&0<f?(f=-1,g.push("Z")):0<m&&0>f&&(f=1,g.push("Y")),c=Math.abs(m),c>=n?g.push(s(c.toString(n))):g.push(c.toString(n));return g.join("")},x=function(e){for(var g=
[],e=e.split(""),a=e.length,f,d=1,c=[],m=0,i=0;i<a;i++)(f=e[i],f in k||"Z"===f||"Y"===f)?(0!==c.length&&(c=parseInt(c.join(""),n)*d+m,g.push(c),m=c),"Z"===f)?(d=-1,c=[]):"Y"===f?(d=1,c=[]):c=[f]:c.push(q[f]);g.push(parseInt(c.join(""),n)*d+m);return g},v=function(g){for(var k=[],a=g.length,f,d=0;d<a;d++)f=g[d],k.push(e(f.x)),k.push(e(f.y));return k.join("_")},t=function(e){for(var g=[],e=e.split("_"),a=e.length/2,f=0;f<a;f++)g.push({x:x(e[2*f]),y:x(e[2*f+1])});return g},g=function(e){return["image/jsignature;base30",
v(e)]},r=function(e,g,a){"string"===typeof e&&("image/jsignature;base30"===e.substring(0,23).toLowerCase()&&(e=e.substring(24)),a(t(e)))};if(null==this.jQuery)throw Error("We need jQuery for some of the functionality. jQuery is not detected. Failing to initialize...");var u=this.jQuery.fn.jSignature;u("addPlugin","export","base30",g);u("addPlugin","export","image/jsignature;base30",g);u("addPlugin","import","base30",r);u("addPlugin","import","image/jsignature;base30",r);this.jSignatureDebug&&(this.jSignatureDebug.base30=
{remapTailChars:s,compressstrokeleg:e,uncompressstrokeleg:x,compressstrokes:v,uncompressstrokes:t,charmap:k})}).call("undefined"!==typeof window?window:this);
(function(){function k(a,f){this.x=a;this.y=f;this.reverse=function(){return new this.constructor(-1*this.x,-1*this.y)};this._length=null;this.getLength=function(){this._length||(this._length=Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)));return this._length};var d=function(a){return Math.round(a/Math.abs(a))};this.resizeTo=function(a){if(0===this.x&&0===this.y)this._length=0;else if(0===this.x)this._length=a,this.y=a*d(this.y);else if(0===this.y)this._length=a,this.x=a*d(this.x);else{var f=Math.abs(this.y/
this.x),e=Math.sqrt(Math.pow(a,2)/(1+Math.pow(f,2))),f=f*e;this._length=a;this.x=e*d(this.x);this.y=f*d(this.y)}return this};this.angleTo=function(a){var d=this.getLength()*a.getLength();return 0===d?0:Math.acos(Math.min(Math.max((this.x*a.x+this.y*a.y)/d,-1),1))/Math.PI}}function q(a,f){this.x=a;this.y=f;this.getVectorToCoordinates=function(a,c){return new k(a-this.x,c-this.y)};this.getVectorFromCoordinates=function(a,c){return this.getVectorToCoordinates(a,c).reverse()};this.getVectorToPoint=function(a){return new k(a.x-
this.x,a.y-this.y)};this.getVectorFromPoint=function(a){return this.getVectorToPoint(a).reverse()}}function g(a,f){var d=Math.pow(10,f);return Math.round(a*d)/d}function n(a,f,d){var f=f+1,c=new q(a.x[f-1],a.y[f-1]),e=new q(a.x[f],a.y[f]),e=c.getVectorToPoint(e),i=new q(a.x[f-2],a.y[f-2]),c=i.getVectorToPoint(c);return c.getLength()>d?(d=2<f?(new q(a.x[f-3],a.y[f-3])).getVectorToPoint(i):new k(0,0),a=0.35*c.getLength(),i=c.angleTo(d.reverse()),f=e.angleTo(c.reverse()),d=(new k(d.x+c.x,d.y+c.y)).resizeTo(Math.max(0.05,
i)*a),e=(new k(c.x+e.x,c.y+e.y)).reverse().resizeTo(Math.max(0.05,f)*a),e=new k(c.x+e.x,c.y+e.y),["c",g(d.x,2),g(d.y,2),g(e.x,2),g(e.y,2),g(c.x,2),g(c.y,2)]):["l",g(c.x,2),g(c.y,2)]}function r(a,f){var d=a.x.length-1,c=new q(a.x[d],a.y[d]),e=new q(a.x[d-1],a.y[d-1]),c=e.getVectorToPoint(c);if(1<d&&c.getLength()>f){var d=(new q(a.x[d-2],a.y[d-2])).getVectorToPoint(e),e=c.angleTo(d.reverse()),i=0.35*c.getLength(),d=(new k(d.x+c.x,d.y+c.y)).resizeTo(Math.max(0.05,e)*i);return["c",g(d.x,2),g(d.y,2),g(c.x,
2),g(c.y,2),g(c.x,2),g(c.y,2)]}return["l",g(c.x,2),g(c.y,2)]}function s(a,f,d){for(var f=["M",g(a.x[0]-f,2),g(a.y[0]-d,2)],d=1,c=a.x.length-1;d<c;d++)f.push.apply(f,n(a,d,1));0<c?f.push.apply(f,r(a,d,1)):0===c&&f.push.apply(f,["l",1,1]);return f.join(" ")}function e(a){var f=['<?xml version="1.0" encoding="UTF-8" standalone="no"?>','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">'],d,c=a.length,e,i=[],g=[],k=e=d=0,l=0,n=[];if(0!==c){for(d=0;d<c;d++){k=
a[d];l=[];e={x:[],y:[]};for(var o=void 0,b=void 0,o=0,b=k.x.length;o<b;o++)l.push({x:k.x[o],y:k.y[o]});l=simplify(l,0.7,!0);o=0;for(b=l.length;o<b;o++)e.x.push(l[o].x),e.y.push(l[o].y);n.push(e);i=i.concat(e.x);g=g.concat(e.y)}a=Math.min.apply(null,i)-1;c=Math.max.apply(null,i)+1;i=Math.min.apply(null,g)-1;g=Math.max.apply(null,g)+1;k=0>a?0:a;l=0>i?0:i;d=c-a;e=g-i}f.push('<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="'+d.toString()+'" height="'+e.toString()+'">');d=0;for(c=n.length;d<
c;d++)e=n[d],f.push('<path fill="none" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="'+s(e,k,l)+'"/>');f.push("</svg>");return f.join("")}function x(a){return[l,e(a)]}function v(a){return[o,u(e(a))]}var t=window;"use strict";("undefined"!=typeof exports?exports:t).simplify=function(a,e,d){e=void 0!==e?e*e:1;if(!d){for(var c=a.length,g,i=a[0],k=[i],d=1;d<c;d++){g=a[d];var l=g.x-i.x,o=g.y-i.y;l*l+o*o>e&&(k.push(g),i=g)}a=(i!==g&&k.push(g),k)}g=a;var d=g.length,
c=new ("undefined"!=typeof Uint8Array?Uint8Array:Array)(d),i=0,k=d-1,n,q,b=[],j=[],p=[];for(c[i]=c[k]=1;k;){o=0;for(l=i+1;l<k;l++){n=g[l];var h=g[i],r=g[k],s=h.x,t=h.y,h=r.x-s,u=r.y-t,v=void 0;if(0!==h||0!==u)v=((n.x-s)*h+(n.y-t)*u)/(h*h+u*u),1<v?(s=r.x,t=r.y):0<v&&(s+=h*v,t+=u*v);n=(h=n.x-s,u=n.y-t,h*h+u*u);n>o&&(q=l,o=n)}o>e&&(c[q]=1,b.push(i),j.push(q),b.push(q),j.push(k));i=b.pop();k=j.pop()}for(l=0;l<d;l++)c[l]&&p.push(g[l]);return a=p,a};if("function"!==typeof u)var u=function(a){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".split(""),
d,c,g,i,k=0,l=0,n="",n=[];do d=a.charCodeAt(k++),c=a.charCodeAt(k++),g=a.charCodeAt(k++),i=d<<16|c<<8|g,d=i>>18&63,c=i>>12&63,g=i>>6&63,i&=63,n[l++]=e[d]+e[c]+e[g]+e[i];while(k<a.length);n=n.join("");a=a.length%3;return(a?n.slice(0,a-3):n)+"===".slice(a||3)};var l="image/svg+xml",o="image/svg+xml;base64";if("undefined"===typeof jQuery)throw Error("We need jQuery for some of the functionality. jQuery is not detected. Failing to initialize...");t=jQuery.fn.jSignature;t("addPlugin","export","svg",x);
t("addPlugin","export",l,x);t("addPlugin","export","svgbase64",v);t("addPlugin","export",o,v)})();