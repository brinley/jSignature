/*

jSignature v2
Copyright (c) 2012 Willow Systems Corp http://willow-systems.com
Copyright (c) 2010 Brinley Ang http://www.unbolt.net
MIT License <http://www.opensource.org/licenses/mit-license.php> 


jSignature v2 jSignature's custom "base30" format export and import plugins.
Copyright (c) 2011 Willow Systems Corp http://willow-systems.com
MIT License <http://www.opensource.org/licenses/mit-license.php>


Simplify.js BSD 
(c) 2012, Vladimir Agafonkin
mourner.github.com/simplify-js


base64 encoder
MIT, GPL
http://phpjs.org/functions/base64_encode
+   original by: Tyler Akins (http://rumkin.com)
+   improved by: Bayron Guevara
+   improved by: Thunder.m
+   improved by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)
+   bugfixed by: Pellentesque Malesuada
+   improved by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)
+   improved by: Rafal Kukawski (http://kukawski.pl)


jSignature v2 SVG export plugin.
Copyright (c) 2012 Willow Systems Corp http://willow-systems.com
MIT License <http://www.opensource.org/licenses/mit-license.php>


jSignature v2 jSignature's Undo Button and undo functionality plugin
Copyright (c) 2011 Willow Systems Corp http://willow-systems.com
MIT License <http://www.opensource.org/licenses/mit-license.php>

*/
(function(){function p(a){for(var k,s=a.css("color"),h;void 0===h&&void 0!==a;){try{k=a.css("background-color")}catch(c){k="transparent"}"transparent"!==k&&"rgba(0, 0, 0, 0)"!==k&&(h=k);try{a=a.parent(),a[0]===document&&(a=void 0)}catch(d){a=void 0}}var a=/rgb[a]*\((\d+),\s*(\d+),\s*(\d+)/,f=/#([AaBbCcDdEeFf\d]{2})([AaBbCcDdEeFf\d]{2})([AaBbCcDdEeFf\d]{2})/,b;k=void 0;(k=s.match(a))?b={r:parseInt(k[1],10),g:parseInt(k[2],10),b:parseInt(k[3],10)}:(k=s.match(f))&&(b={r:parseInt(k[1],16),g:parseInt(k[2],
16),b:parseInt(k[3],16)});var g;h?(k=void 0,(k=h.match(a))?g={r:parseInt(k[1],10),g:parseInt(k[2],10),b:parseInt(k[3],10)}:(k=h.match(f))&&(g={r:parseInt(k[1],16),g:parseInt(k[2],16),b:parseInt(k[3],16)})):g=b?127<Math.max.apply(null,[b.r,b.g,b.b])?{r:0,g:0,b:0}:{r:255,g:255,b:255}:{r:255,g:255,b:255};k=function(a){return"rgb("+[a.r,a.g,a.b].join(", ")+")"};b&&g?(a=Math.max.apply(null,[b.r,b.g,b.b]),b=Math.max.apply(null,[g.r,g.g,g.b]),b=Math.round(b+-0.75*(b-a)),b={r:b,g:b,b:b}):b?(b=Math.max.apply(null,
[b.r,b.g,b.b]),a=1,127<b&&(a=-1),b=Math.round(b+96*a),b={r:b,g:b,b:b}):b={r:191,g:191,b:191};return{color:s,"background-color":g?k(g):h,"decor-color":k(b)}}function o(a,k){this.x=a;this.y=k;this.reverse=function(){return new this.constructor(-1*this.x,-1*this.y)};this._length=null;this.getLength=function(){this._length||(this._length=Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)));return this._length};var s=function(a){return Math.round(a/Math.abs(a))};this.resizeTo=function(a){if(0===this.x&&0===
this.y)this._length=0;else if(0===this.x)this._length=a,this.y=a*s(this.y);else if(0===this.y)this._length=a,this.x=a*s(this.x);else{var k=Math.abs(this.y/this.x),b=Math.sqrt(Math.pow(a,2)/(1+Math.pow(k,2))),k=k*b;this._length=a;this.x=b*s(this.x);this.y=k*s(this.y)}return this};this.angleTo=function(a){var k=this.getLength()*a.getLength();return 0===k?0:Math.acos(Math.min(Math.max((this.x*a.x+this.y*a.y)/k,-1),1))/Math.PI}}function j(a,k){this.x=a;this.y=k;this.getVectorToCoordinates=function(a,
k){return new o(a-this.x,k-this.y)};this.getVectorFromCoordinates=function(a,k){return this.getVectorToCoordinates(a,k).reverse()};this.getVectorToPoint=function(a){return new o(a.x-this.x,a.y-this.y)};this.getVectorFromPoint=function(a){return this.getVectorToPoint(a).reverse()}}function q(a,k,b,h,c){this.data=a;this.context=k;if(a.length)for(var d=a.length,f,g,l=0;l<d;l++){f=a[l];g=f.x.length;b.call(k,f);for(var e=1;e<g;e++)h.call(k,f,e);c.call(k,f)}this.changed=function(){};this.startStrokeFn=
b;this.addToStrokeFn=h;this.endStrokeFn=c;this.inStroke=!1;this._stroke=this._lastPoint=null;this.startStroke=function(a){if(a&&"number"==typeof a.x&&"number"==typeof a.y){this._stroke={x:[a.x],y:[a.y]};this.data.push(this._stroke);this._lastPoint=a;this.inStroke=!0;var k=this._stroke,b=this.startStrokeFn,h=this.context;setTimeout(function(){b.call(h,k)},3);return a}return null};this.addToStroke=function(a){if(this.inStroke&&"number"===typeof a.x&&"number"===typeof a.y&&4<Math.abs(a.x-this._lastPoint.x)+
Math.abs(a.y-this._lastPoint.y)){var k=this._stroke.x.length;this._stroke.x.push(a.x);this._stroke.y.push(a.y);this._lastPoint=a;var b=this._stroke,h=this.addToStrokeFn,s=this.context;setTimeout(function(){h.call(s,b,k)},3);return a}return null};this.endStroke=function(){var a=this.inStroke;this.inStroke=!1;this._lastPoint=null;if(a){var k=this._stroke,b=this.endStrokeFn,h=this.context,s=this.changed;setTimeout(function(){b.call(h,k);s.call(h)},3);return!0}return null}}function m(a,k,b){var h=this.$parent=
$(a),a=this.eventTokens={};this.events=new t(this);var c=$.fn[e]("globalEvents"),d={width:"ratio",height:"ratio",sizeRatio:4,color:"#000","background-color":"#fff","decor-color":"#eee",lineWidth:0,minFatFingerCompensation:-10,showUndoButton:!1,data:[]};$.extend(d,p(h));k&&$.extend(d,k);this.settings=d;for(var f in b)b.hasOwnProperty(f)&&b[f].call(this,f);this.events.publish(e+".initializing");this.$controlbarUpper=$('<div style="padding:0 !important;margin:0 !important;width: 100% !important; height: 0 !important;margin-top:-1em !important;margin-bottom:1em !important;"></div>').appendTo(h);
this.isCanvasEmulator=!1;b=this.canvas=this.initializeCanvas(d);k=$(b);this.$controlbarLower=$('<div style="padding:0 !important;margin:0 !important;width: 100% !important; height: 0 !important;margin-top:-1.5em !important;margin-bottom:1.5em !important;"></div>').appendTo(h);this.canvasContext=b.getContext("2d");k.data(e+".this",this);h=(h=d.lineWidth)?h:Math.max(Math.round(b.width/400),2);d.lineWidth=h;this.lineCurveThreshold=3*d.lineWidth;d.cssclass&&""!=$.trim(d.cssclass)&&k.addClass(d.cssclass);
this.fatFingerCompensation=0;var h=function(a){var k,b,h=function(h){h=h.changedTouches&&0<h.changedTouches.length?h.changedTouches[0]:h;return new j(Math.round(h.pageX+k),Math.round(h.pageY+b)+a.fatFingerCompensation)},d=new u(750,function(){a.dataEngine.endStroke()});this.drawEndHandler=function(k){try{k.preventDefault()}catch(b){}d.clear();a.dataEngine.endStroke()};this.drawStartHandler=function(c){c.preventDefault();var s=$(a.canvas).offset();k=-1*s.left;b=-1*s.top;a.dataEngine.startStroke(h(c));
d.kick()};this.drawMoveHandler=function(k){k.preventDefault();a.dataEngine.inStroke&&(a.dataEngine.addToStroke(h(k)),d.kick())};return this}.call({},this),g=h.drawEndHandler,l=h.drawStartHandler,r=h.drawMoveHandler,i=this.canvas,k=$(i);this.isCanvasEmulator?(k.bind("mousemove."+e,r),k.bind("mouseup."+e,g),k.bind("mousedown."+e,l)):(i.ontouchstart=function(a){i.onmousedown=void 0;i.onmouseup=void 0;i.onmousemove=void 0;this.fatFingerCompensation=d.minFatFingerCompensation&&-3*d.lineWidth>d.minFatFingerCompensation?
-3*d.lineWidth:d.minFatFingerCompensation;l(a);i.ontouchend=g;i.ontouchstart=l;i.ontouchmove=r},i.onmousedown=function(a){i.ontouchstart=void 0;i.ontouchend=void 0;i.ontouchmove=void 0;l(a);i.onmousedown=l;i.onmouseup=g;i.onmousemove=r});a[e+".windowmouseup"]=c.subscribe(e+".windowmouseup",h.drawEndHandler);this.events.publish(e+".attachingEventHandlers");var n=this,a=d.width.toString(10),w=e;if("ratio"===a||"%"===a.split("")[a.length-1])this.eventTokens[w+".parentresized"]=c.subscribe(w+".parentresized",
function(a,k,b){return function(){var h=k.width();if(h!==b){for(var d in a)if(a.hasOwnProperty(d)){c.unsubscribe(a[d]);delete a[d]}var s=n.settings;n.$parent.children().remove();for(d in n)n.hasOwnProperty(d)&&delete n[d];d=s.data;var h=h*1/b,f=[],g,l,e,i,r,j;l=0;for(e=d.length;l<e;l++){j=d[l];g={x:[],y:[]};i=0;for(r=j.x.length;i<r;i++){g.x.push(j.x[i]*h);g.y.push(j.y[i]*h)}f.push(g)}s.data=f;k[w](s)}}}(this.eventTokens,this.$parent,this.$parent.width(),1*this.canvas.width/this.canvas.height));this.resetCanvas(d.data);
this.events.publish(e+".initialized");return this}var e="jSignature",u=function(a,k){var b;this.kick=function(){clearTimeout(b);b=setTimeout(k,a)};this.clear=function(){clearTimeout(b)};return this},t=function(a){this.topics={};this.context=a?a:this;this.publish=function(a,b,h,d){if(this.topics[a]){var c=this.topics[a],f=Array.prototype.slice.call(arguments,1),g=[],l,e,i,j;e=0;for(i=c.length;e<i;e++)j=c[e],l=j[0],j[1]&&(j[0]=function(){},g.push(e)),l.apply(this.context,f);e=0;for(i=g.length;e<i;e++)c.splice(g[e],
1)}};this.subscribe=function(a,b,h){this.topics[a]?this.topics[a].push([b,h]):this.topics[a]=[[b,h]];return{topic:a,callback:b}};this.unsubscribe=function(a){if(this.topics[a.topic])for(var b=this.topics[a.topic],h=0,d=b.length;h<d;h++)b[h][0]===a.callback&&b.splice(h,1)}},y=function(a){var b=this.canvasContext,d=a.x[0],a=a.y[0],h=this.settings.lineWidth,c=b.fillStyle;b.fillStyle=b.strokeStyle;b.fillRect(d+h/-2,a+h/-2,h,h);b.fillStyle=c},v=function(a,b){var d=new j(a.x[b-1],a.y[b-1]),h=new j(a.x[b],
a.y[b]),c=d.getVectorToPoint(h);if(1<b){var f=new j(a.x[b-2],a.y[b-2]),g=f.getVectorToPoint(d),l;if(g.getLength()>this.lineCurveThreshold){l=2<b?(new j(a.x[b-3],a.y[b-3])).getVectorToPoint(f):new o(0,0);var e=0.35*g.getLength(),i=g.angleTo(l.reverse()),r=c.angleTo(g.reverse());l=(new o(l.x+g.x,l.y+g.y)).resizeTo(Math.max(0.05,i)*e);var n=(new o(g.x+c.x,g.y+c.y)).reverse().resizeTo(Math.max(0.05,r)*e),g=this.canvasContext,e=f.x,r=f.y,i=d.x,w=d.y,z=f.x+l.x,f=f.y+l.y;l=d.x+n.x;n=d.y+n.y;g.beginPath();
g.moveTo(e,r);g.bezierCurveTo(z,f,l,n,i,w);g.stroke()}}c.getLength()<=this.lineCurveThreshold&&(c=this.canvasContext,f=d.x,d=d.y,l=h.x,h=h.y,c.beginPath(),c.moveTo(f,d),c.lineTo(l,h),c.stroke())},x=function(a){var b=a.x.length-1;if(0<b){var d=new j(a.x[b],a.y[b]),h=new j(a.x[b-1],a.y[b-1]),c=h.getVectorToPoint(d);if(c.getLength()>this.lineCurveThreshold){if(1<b){var a=(new j(a.x[b-2],a.y[b-2])).getVectorToPoint(h),f=(new o(a.x+c.x,a.y+c.y)).resizeTo(c.getLength()/2),c=this.canvasContext,a=h.x,b=h.y,
g=d.x,l=d.y,e=h.x+f.x,h=h.y+f.y,f=d.x,d=d.y;c.beginPath();c.moveTo(a,b);c.bezierCurveTo(e,h,f,d,g,l)}else c=this.canvasContext,a=h.x,h=h.y,b=d.x,d=d.y,c.beginPath(),c.moveTo(a,h),c.lineTo(b,d);c.stroke()}}};m.prototype.resetCanvas=function(a){var b=this.canvas,d=this.settings,c=this.canvasContext,f=this.isCanvasEmulator,g=b.width,l=b.height;c.clearRect(0,0,g+30,l+30);c.shadowColor=c.fillStyle=d["background-color"];f&&c.fillRect(0,0,g+30,l+30);c.lineWidth=Math.ceil(parseInt(d.lineWidth,10));c.lineCap=
c.lineJoin="round";c.strokeStyle=d["decor-color"];c.shadowOffsetX=0;c.shadowOffsetY=0;var i=Math.round(l/5),j=1.5*i,r=l-i,g=g-1.5*i,l=l-i;c.beginPath();c.moveTo(j,r);c.lineTo(g,l);c.stroke();c.strokeStyle=d.color;f||(c.shadowColor=c.strokeStyle,c.shadowOffsetX=0.5*c.lineWidth,c.shadowOffsetY=-0.6*c.lineWidth,c.shadowBlur=0);a||(a=[]);c=this.dataEngine=new q(a,this,y,v,x);d.data=a;$(b).data(e+".data",a).data(e+".settings",d);var n=this.$parent,w=this.events,z=e;c.changed=function(){w.publish(z+".change");
n.trigger("change")};c.changed();return!0};m.prototype.initializeCanvas=function(a){var b=document.createElement("canvas"),c=$(b);a.width===a.height&&"ratio"===a.height&&(a.width="100%");c.css("margin",0).css("padding",0).css("border","none").css("height","ratio"===a.height||!a.height?1:a.height.toString(10)).css("width","ratio"===a.width||!a.width?1:a.width.toString(10));c.appendTo(this.$parent);"ratio"===a.height?c.css("height",Math.round(c.width()/a.sizeRatio)):"ratio"===a.width&&c.css("width",
Math.round(c.height()*a.sizeRatio));c.addClass(e);b.width=c.width();b.height=c.height();a=b;if(a.getContext)a=!1;else if("undefined"!==typeof FlashCanvas)a=FlashCanvas.initElement(a),c=1,window&&(window.screen&&window.screen.deviceXDPI&&window.screen.logicalXDPI)&&(c=1*window.screen.deviceXDPI/window.screen.logicalXDPI),1!==c&&($(a).children("object").get(0).resize(Math.ceil(a.width*c),Math.ceil(a.height*c)),a.getContext("2d").scale(c,c)),a=!0;else throw Error("Canvas element does not support 2d context. jSignature cannot proceed.");
this.isCanvasEmulator=a;b.onselectstart=function(a){a&&a.preventDefault&&a.preventDefault();a&&a.stopPropagation&&a.stopPropagation();return false};return b};if(null==this.jQuery)throw Error("We need jQuery for some of the functionality. jQuery is not detected. Failing to initialize...");var r=this.jQuery,i=function(a,b){var c=new Image,d=this;c.onload=function(){d.getContext("2d").drawImage(c,0,0,c.width<d.width?c.width:d.width,c.height<d.height?c.height:d.height)};c.src="data:"+b+","+a},f=function(a){this.find("canvas."+
e).add(this.filter("canvas."+e)).data(e+".this").resetCanvas(a);return this},b=function(a,b){if(void 0===b&&("string"===typeof a&&"data:"===a.substr(0,5))&&(b=a.slice(5).split(",")[0],a=a.slice(6+b.length),b===a))return;var c=this.find("canvas."+e).add(this.filter("canvas."+e));if(n.hasOwnProperty(b))0!==c.length&&n[b].call(c[0],a,b,function(a){return function(){return a.resetCanvas(arguments)}}(c.data(e+".this")));else throw Error(e+" is unable to find import plugin with for format '"+String(b)+
"'");return this},d=new t,c=e,g,l=function(){d.publish(c+".parentresized")};r(window).bind("resize."+c,function(){g&&clearTimeout(g);g=setTimeout(l,500)}).bind("mouseup."+c,function(a){d.publish(c+".windowmouseup",a)});var w={exampleExtension:function(a){this.events.subscribe(e+".initializing",function(){this.settings.hasOwnProperty("non-existent setting category?")&&console.log(a+" is here")})}},z={"default":function(){return this.toDataURL()},"native":function(a){return a},image:function(){var a=
this.toDataURL();if("string"===typeof a&&4<a.length&&"data:"===a.slice(0,5)&&-1!==a.indexOf(",")){var b=a.indexOf(",");return[a.slice(5,b),a.substr(b+1)]}return[]}},n={"native":function(a,b,c){c(a)},image:i,"image/png;base64":i,"image/jpeg;base64":i,"image/jpg;base64":i},A={"export":z,"import":n,instance:w},B={init:function(a){return this.each(function(){new m(this,a,w)})},getSettings:function(){return this.find("canvas."+e).add(this.filter("canvas."+e)).data(e+".this").settings},clear:f,reset:f,
addPlugin:function(a,b,c){A.hasOwnProperty(a)&&(A[a][b]=c);return this},listPlugins:function(a){var b=[];if(A.hasOwnProperty(a)){var a=A[a],c;for(c in a)a.hasOwnProperty(c)&&b.push(c)}return b},getData:function(a){var b=this.find("canvas."+e).add(this.filter("canvas."+e));void 0===a&&(a="default");if(0!==b.length&&z.hasOwnProperty(a))return z[a].call(b.get(0),b.data(e+".data"))},importData:b,setData:b,globalEvents:function(){return d},events:function(){return this.find("canvas."+e).add(this.filter("canvas."+
e)).data(e+".this").events}};r.fn[e]=function(a){if(!a||"object"===typeof a)return B.init.apply(this,arguments);if("string"===typeof a&&B[a])return B[a].apply(this,Array.prototype.slice.call(arguments,1));r.error("Method "+String(a)+" does not exist on jQuery."+e)}})();
(function(){for(var p={},o={},j="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWX".split(""),q=j.length/2,m=q-1;-1<m;m--)p[j[m]]=j[m+q],o[j[m+q]]=j[m];var e=function(e){for(var e=e.split(""),i=e.length,f=1;f<i;f++)e[f]=p[e[f]];return e.join("")},u=function(j){for(var i=[],f=0,b=1,d=j.length,c,g,l=0;l<d;l++)c=Math.round(j[l]),g=c-f,f=c,0>g&&0<b?(b=-1,i.push("Z")):0<g&&0>b&&(b=1,i.push("Y")),c=Math.abs(g),c>=q?i.push(e(c.toString(q))):i.push(c.toString(q));return i.join("")},t=function(e){for(var i=
[],e=e.split(""),f=e.length,b,d=1,c=[],g=0,l=0;l<f;l++)(b=e[l],b in p||"Z"===b||"Y"===b)?(0!==c.length&&(c=parseInt(c.join(""),q)*d+g,i.push(c),g=c),"Z"===b)?(d=-1,c=[]):"Y"===b?(d=1,c=[]):c=[b]:c.push(o[b]);i.push(parseInt(c.join(""),q)*d+g);return i},y=function(e){for(var i=[],f=e.length,b,d=0;d<f;d++)b=e[d],i.push(u(b.x)),i.push(u(b.y));return i.join("_")},v=function(e){for(var i=[],e=e.split("_"),f=e.length/2,b=0;b<f;b++)i.push({x:t(e[2*b]),y:t(e[2*b+1])});return i},j=function(e){return["image/jsignature;base30",
y(e)]},m=function(e,i,f){"string"===typeof e&&("image/jsignature;base30"===e.substring(0,23).toLowerCase()&&(e=e.substring(24)),f(v(e)))};if(null==this.jQuery)throw Error("We need jQuery for some of the functionality. jQuery is not detected. Failing to initialize...");var x=this.jQuery.fn.jSignature;x("addPlugin","export","base30",j);x("addPlugin","export","image/jsignature;base30",j);x("addPlugin","import","base30",m);x("addPlugin","import","image/jsignature;base30",m);this.jSignatureDebug&&(this.jSignatureDebug.base30=
{remapTailChars:e,compressstrokeleg:u,uncompressstrokeleg:t,compressstrokes:y,uncompressstrokes:v,charmap:p})}).call("undefined"!==typeof window?window:this);
(function(){function p(f,b){this.x=f;this.y=b;this.reverse=function(){return new this.constructor(-1*this.x,-1*this.y)};this._length=null;this.getLength=function(){this._length||(this._length=Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)));return this._length};var d=function(b){return Math.round(b/Math.abs(b))};this.resizeTo=function(b){if(0===this.x&&0===this.y)this._length=0;else if(0===this.x)this._length=b,this.y=b*d(this.y);else if(0===this.y)this._length=b,this.x=b*d(this.x);else{var f=Math.abs(this.y/
this.x),e=Math.sqrt(Math.pow(b,2)/(1+Math.pow(f,2))),f=f*e;this._length=b;this.x=e*d(this.x);this.y=f*d(this.y)}return this};this.angleTo=function(b){var d=this.getLength()*b.getLength();return 0===d?0:Math.acos(Math.min(Math.max((this.x*b.x+this.y*b.y)/d,-1),1))/Math.PI}}function o(f,b){this.x=f;this.y=b;this.getVectorToCoordinates=function(b,c){return new p(b-this.x,c-this.y)};this.getVectorFromCoordinates=function(b,c){return this.getVectorToCoordinates(b,c).reverse()};this.getVectorToPoint=function(b){return new p(b.x-
this.x,b.y-this.y)};this.getVectorFromPoint=function(b){return this.getVectorToPoint(b).reverse()}}function j(f,b){var d=Math.pow(10,b);return Math.round(f*d)/d}function q(f,b,d){var b=b+1,c=new o(f.x[b-1],f.y[b-1]),g=new o(f.x[b],f.y[b]),g=c.getVectorToPoint(g),e=new o(f.x[b-2],f.y[b-2]),c=e.getVectorToPoint(c);return c.getLength()>d?(d=2<b?(new o(f.x[b-3],f.y[b-3])).getVectorToPoint(e):new p(0,0),f=0.35*c.getLength(),e=c.angleTo(d.reverse()),b=g.angleTo(c.reverse()),d=(new p(d.x+c.x,d.y+c.y)).resizeTo(Math.max(0.05,
e)*f),g=(new p(c.x+g.x,c.y+g.y)).reverse().resizeTo(Math.max(0.05,b)*f),g=new p(c.x+g.x,c.y+g.y),["c",j(d.x,2),j(d.y,2),j(g.x,2),j(g.y,2),j(c.x,2),j(c.y,2)]):["l",j(c.x,2),j(c.y,2)]}function m(f,b){var d=f.x.length-1,c=new o(f.x[d],f.y[d]),g=new o(f.x[d-1],f.y[d-1]),c=g.getVectorToPoint(c);if(1<d&&c.getLength()>b){var d=(new o(f.x[d-2],f.y[d-2])).getVectorToPoint(g),g=c.angleTo(d.reverse()),e=0.35*c.getLength(),d=(new p(d.x+c.x,d.y+c.y)).resizeTo(Math.max(0.05,g)*e);return["c",j(d.x,2),j(d.y,2),j(c.x,
2),j(c.y,2),j(c.x,2),j(c.y,2)]}return["l",j(c.x,2),j(c.y,2)]}function e(f,b,d){for(var b=["M",j(f.x[0]-b,2),j(f.y[0]-d,2)],d=1,c=f.x.length-1;d<c;d++)b.push.apply(b,q(f,d,1));0<c?b.push.apply(b,m(f,d,1)):0===c&&b.push.apply(b,["l",1,1]);return b.join(" ")}function u(f){var b=['<?xml version="1.0" encoding="UTF-8" standalone="no"?>','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">'],d,c=f.length,g,l=[],i=[],j=g=d=0,n=0,o=[];if(0!==c){for(d=0;d<c;d++){j=
f[d];n=[];g={x:[],y:[]};for(var m=void 0,a=void 0,m=0,a=j.x.length;m<a;m++)n.push({x:j.x[m],y:j.y[m]});n=simplify(n,0.7,!0);m=0;for(a=n.length;m<a;m++)g.x.push(n[m].x),g.y.push(n[m].y);o.push(g);l=l.concat(g.x);i=i.concat(g.y)}f=Math.min.apply(null,l)-1;c=Math.max.apply(null,l)+1;l=Math.min.apply(null,i)-1;i=Math.max.apply(null,i)+1;j=0>f?0:f;n=0>l?0:l;d=c-f;g=i-l}b.push('<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="'+d.toString()+'" height="'+g.toString()+'">');d=0;for(c=o.length;d<
c;d++)g=o[d],b.push('<path fill="none" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="'+e(g,j,n)+'"/>');b.push("</svg>");return b.join("")}function t(f){return[r,u(f)]}function y(f){return[i,x(u(f))]}var v=window;"use strict";("undefined"!=typeof exports?exports:v).simplify=function(f,b,d){b=void 0!==b?b*b:1;if(!d){for(var c=f.length,g,e=f[0],i=[e],d=1;d<c;d++){g=f[d];var j=g.x-e.x,n=g.y-e.y;j*j+n*n>b&&(i.push(g),e=g)}f=(e!==g&&i.push(g),i)}g=f;var d=g.length,
c=new ("undefined"!=typeof Uint8Array?Uint8Array:Array)(d),e=0,i=d-1,m,o,a=[],k=[],s=[];for(c[e]=c[i]=1;i;){n=0;for(j=e+1;j<i;j++){m=g[j];var h=g[e],r=g[i],p=h.x,u=h.y,h=r.x-p,q=r.y-u,t=void 0;if(0!==h||0!==q)t=((m.x-p)*h+(m.y-u)*q)/(h*h+q*q),1<t?(p=r.x,u=r.y):0<t&&(p+=h*t,u+=q*t);m=(h=m.x-p,q=m.y-u,h*h+q*q);m>n&&(o=j,n=m)}n>b&&(c[o]=1,a.push(e),k.push(o),a.push(o),k.push(i));e=a.pop();i=k.pop()}for(j=0;j<d;j++)c[j]&&s.push(g[j]);return f=s,f};if("function"!==typeof x)var x=function(f){var b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".split(""),
d,c,e,i,j=0,m=0,n="",n=[];do d=f.charCodeAt(j++),c=f.charCodeAt(j++),e=f.charCodeAt(j++),i=d<<16|c<<8|e,d=i>>18&63,c=i>>12&63,e=i>>6&63,i&=63,n[m++]=b[d]+b[c]+b[e]+b[i];while(j<f.length);n=n.join("");f=f.length%3;return(f?n.slice(0,f-3):n)+"===".slice(f||3)};var r="image/svg+xml",i="image/svg+xml;base64";if("undefined"===typeof $)throw Error("We need jQuery for some of the functionality. jQuery is not detected. Failing to initialize...");v=$.fn.jSignature;v("addPlugin","export","svg",t);v("addPlugin",
"export",r,t);v("addPlugin","export","svgbase64",y);v("addPlugin","export",i,y)})();
(function(){$.fn.jSignature("addPlugin","instance","UndoButton",function(p){this.events.subscribe("jSignature.attachingEventHandlers",function(){if(this.settings[p]){var o=this.settings[p];"function"!==typeof o&&(o=function(){var e=$('<input type="button" value="Undo last stroke" style="position:absolute;display:none;margin:0 !important;top:auto" />').appendTo(this.$controlbarLower),j=e.width();e.css("left",Math.round((this.canvas.width-j)/2));j!==e.width()&&e.width(j);return e});var j=o.call(this),
q=this;q.events.subscribe("jSignature.change",function(){q.dataEngine.data.length?j.show():j.hide()});var m=this,e=(this.events.topics.hasOwnProperty("jSignature.undo")?p:"jSignature")+".undo";j.bind("click",function(){m.events.publish(e)});m.events.subscribe(e,function(){var e=m.dataEngine.data;e.length&&(e.pop(),m.resetCanvas(e))})}})})})();