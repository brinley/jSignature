/*

jSignature v2
Copyright (c) 2012 Willow Systems Corp http://willow-systems.com
Copyright (c) 2010 Brinley Ang http://www.unbolt.net
MIT License <http://www.opensource.org/licenses/mit-license.php> 


jSignature v2 jSignature's custom "base30" format export and import plugins.
Copyright (c) 2011 Willow Systems Corp http://willow-systems.com
MIT License <http://www.opensource.org/licenses/mit-license.php>


Simplify.js BSD 
(c) 2012, Vladimir Agafonkin
mourner.github.com/simplify-js


base64 encoder
MIT, GPL
http://phpjs.org/functions/base64_encode
+   original by: Tyler Akins (http://rumkin.com)
+   improved by: Bayron Guevara
+   improved by: Thunder.m
+   improved by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)
+   bugfixed by: Pellentesque Malesuada
+   improved by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)
+   improved by: Rafal Kukawski (http://kukawski.pl)


jSignature v2 SVG export plugin.
Copyright (c) 2012 Willow Systems Corp http://willow-systems.com
MIT License <http://www.opensource.org/licenses/mit-license.php>


jSignature v2 jSignature's Undo Button and undo functionality plugin
Copyright (c) 2011 Willow Systems Corp http://willow-systems.com
MIT License <http://www.opensource.org/licenses/mit-license.php>

*/
(function(){function r(a){for(var i,q=a.css("color"),l;void 0===l&&void 0!==a;){try{i=a.css("background-color")}catch(d){i="transparent"}"transparent"!==i&&"rgba(0, 0, 0, 0)"!==i&&(l=i);try{a=a.parent(),a[0]===document&&(a=void 0)}catch(c){a=void 0}}var a=/rgb[a]*\((\d+),\s*(\d+),\s*(\d+)/,e=/#([AaBbCcDdEeFf\d]{2})([AaBbCcDdEeFf\d]{2})([AaBbCcDdEeFf\d]{2})/,b;i=void 0;(i=q.match(a))?b={r:parseInt(i[1],10),g:parseInt(i[2],10),b:parseInt(i[3],10)}:(i=q.match(e))&&(b={r:parseInt(i[1],16),g:parseInt(i[2],
16),b:parseInt(i[3],16)});var g;l?(i=void 0,(i=l.match(a))?g={r:parseInt(i[1],10),g:parseInt(i[2],10),b:parseInt(i[3],10)}:(i=l.match(e))&&(g={r:parseInt(i[1],16),g:parseInt(i[2],16),b:parseInt(i[3],16)})):g=b?127<Math.max.apply(null,[b.r,b.g,b.b])?{r:0,g:0,b:0}:{r:255,g:255,b:255}:{r:255,g:255,b:255};i=function(a){return"rgb("+[a.r,a.g,a.b].join(", ")+")"};b&&g?(a=Math.max.apply(null,[b.r,b.g,b.b]),b=Math.max.apply(null,[g.r,g.g,g.b]),b=Math.round(b+-0.75*(b-a)),b={r:b,g:b,b:b}):b?(b=Math.max.apply(null,
[b.r,b.g,b.b]),a=1,127<b&&(a=-1),b=Math.round(b+96*a),b={r:b,g:b,b:b}):b={r:191,g:191,b:191};return{color:q,"background-color":g?i(g):l,"decor-color":i(b)}}function o(a,i){this.x=a;this.y=i;this.reverse=function(){return new this.constructor(-1*this.x,-1*this.y)};this._length=null;this.getLength=function(){this._length||(this._length=Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)));return this._length};var q=function(a){return Math.round(a/Math.abs(a))};this.resizeTo=function(a){if(0===this.x&&0===
this.y)this._length=0;else if(0===this.x)this._length=a,this.y=a*q(this.y);else if(0===this.y)this._length=a,this.x=a*q(this.x);else{var i=Math.abs(this.y/this.x),b=Math.sqrt(Math.pow(a,2)/(1+Math.pow(i,2))),i=i*b;this._length=a;this.x=b*q(this.x);this.y=i*q(this.y)}return this};this.angleTo=function(a){var i=this.getLength()*a.getLength();return 0===i?0:Math.acos(Math.min(Math.max((this.x*a.x+this.y*a.y)/i,-1),1))/Math.PI}}function h(a,i){this.x=a;this.y=i;this.getVectorToCoordinates=function(a,
i){return new o(a-this.x,i-this.y)};this.getVectorFromCoordinates=function(a,i){return this.getVectorToCoordinates(a,i).reverse()};this.getVectorToPoint=function(a){return new o(a.x-this.x,a.y-this.y)};this.getVectorFromPoint=function(a){return this.getVectorToPoint(a).reverse()}}function s(a,i,b,l,d){this.data=a;this.context=i;if(a.length)for(var c=a.length,e,g,j=0;j<c;j++){e=a[j];g=e.x.length;b.call(i,e);for(var f=1;f<g;f++)l.call(i,e,f);d.call(i,e)}this.changed=function(){};this.startStrokeFn=
b;this.addToStrokeFn=l;this.endStrokeFn=d;this.inStroke=!1;this._stroke=this._lastPoint=null;this.startStroke=function(a){if(a&&"number"==typeof a.x&&"number"==typeof a.y){this._stroke={x:[a.x],y:[a.y]};this.data.push(this._stroke);this._lastPoint=a;this.inStroke=!0;var i=this._stroke,b=this.startStrokeFn,q=this.context;setTimeout(function(){b.call(q,i)},3);return a}return null};this.addToStroke=function(a){if(this.inStroke&&"number"===typeof a.x&&"number"===typeof a.y&&4<Math.abs(a.x-this._lastPoint.x)+
Math.abs(a.y-this._lastPoint.y)){var i=this._stroke.x.length;this._stroke.x.push(a.x);this._stroke.y.push(a.y);this._lastPoint=a;var b=this._stroke,q=this.addToStrokeFn,l=this.context;setTimeout(function(){q.call(l,b,i)},3);return a}return null};this.endStroke=function(){var a=this.inStroke;this.inStroke=!1;this._lastPoint=null;if(a){var i=this._stroke,b=this.endStrokeFn,q=this.context,l=this.changed;setTimeout(function(){b.call(q,i);l.call(q)},3);return!0}return null}}function n(a,i,b){var l=this.$parent=
$(a),a=this.eventTokens={};this.events=new x(this);var d=$.fn[f]("globalEvents"),c={width:"ratio",height:"ratio",sizeRatio:4,color:"#000","background-color":"#fff","decor-color":"#eee",lineWidth:0,minFatFingerCompensation:-10,showUndoButton:!1,data:[]};$.extend(c,r(l));i&&$.extend(c,i);this.settings=c;for(var e in b)b.hasOwnProperty(e)&&b[e].call(this,e);this.events.publish(f+".initializing");this.$controlbarUpper=$('<div style="padding:0 !important;margin:0 !important;width: 100% !important; height: 0 !important;margin-top:-1em !important;margin-bottom:1em !important;"></div>').appendTo(l);
this.isCanvasEmulator=!1;b=this.canvas=this.initializeCanvas(c);i=$(b);this.$controlbarLower=$('<div style="padding:0 !important;margin:0 !important;width: 100% !important; height: 0 !important;margin-top:-1.5em !important;margin-bottom:1.5em !important;"></div>').appendTo(l);this.canvasContext=b.getContext("2d");i.data(f+".this",this);l=(l=c.lineWidth)?l:Math.max(Math.round(b.width/400),2);c.lineWidth=l;this.lineCurveThreshold=3*c.lineWidth;c.cssclass&&""!=$.trim(c.cssclass)&&i.addClass(c.cssclass);
this.fatFingerCompensation=0;var l=function(a){var i,b,c=function(c){c=c.changedTouches&&0<c.changedTouches.length?c.changedTouches[0]:c;return new h(Math.round(c.pageX+i),Math.round(c.pageY+b)+a.fatFingerCompensation)},l=new t(750,function(){a.dataEngine.endStroke()});this.drawEndHandler=function(i){try{i.preventDefault()}catch(b){}l.clear();a.dataEngine.endStroke()};this.drawStartHandler=function(d){d.preventDefault();var q=$(a.canvas).offset();i=-1*q.left;b=-1*q.top;a.dataEngine.startStroke(c(d));
l.kick()};this.drawMoveHandler=function(i){i.preventDefault();a.dataEngine.inStroke&&(a.dataEngine.addToStroke(c(i)),l.kick())};return this}.call({},this),g=l.drawEndHandler,j=l.drawStartHandler,m=l.drawMoveHandler,k=this.canvas,i=$(k);this.isCanvasEmulator?(i.bind("mousemove."+f,m),i.bind("mouseup."+f,g),i.bind("mousedown."+f,j)):(k.ontouchstart=function(a){k.onmousedown=void 0;k.onmouseup=void 0;k.onmousemove=void 0;this.fatFingerCompensation=c.minFatFingerCompensation&&-3*c.lineWidth>c.minFatFingerCompensation?
-3*c.lineWidth:c.minFatFingerCompensation;j(a);k.ontouchend=g;k.ontouchstart=j;k.ontouchmove=m},k.onmousedown=function(a){k.ontouchstart=void 0;k.ontouchend=void 0;k.ontouchmove=void 0;j(a);k.onmousedown=j;k.onmouseup=g;k.onmousemove=m});a[f+".windowmouseup"]=d.subscribe(f+".windowmouseup",l.drawEndHandler);this.events.publish(f+".attachingEventHandlers");var u=this,a=c.width.toString(10),p=f;if("ratio"===a||"%"===a.split("")[a.length-1])this.eventTokens[p+".parentresized"]=d.subscribe(p+".parentresized",
function(a,i,b){return function(){var c=i.width();if(c!==b){for(var l in a)if(a.hasOwnProperty(l)){d.unsubscribe(a[l]);delete a[l]}var q=u.settings;u.$parent.children().remove();for(l in u)u.hasOwnProperty(l)&&delete u[l];l=q.data;var c=c*1/b,e=[],g,j,f,k,m,h;j=0;for(f=l.length;j<f;j++){h=l[j];g={x:[],y:[]};k=0;for(m=h.x.length;k<m;k++){g.x.push(h.x[k]*c);g.y.push(h.y[k]*c)}e.push(g)}q.data=e;i[p](q)}}}(this.eventTokens,this.$parent,this.$parent.width(),1*this.canvas.width/this.canvas.height));this.resetCanvas(c.data);
this.events.publish(f+".initialized");return this}var f="jSignature",t=function(a,i){var b;this.kick=function(){clearTimeout(b);b=setTimeout(i,a)};this.clear=function(){clearTimeout(b)};return this},x=function(a){this.topics={};this.context=a?a:this;this.publish=function(a,b,c,d){if(this.topics[a]){var e=this.topics[a],g=Array.prototype.slice.call(arguments,1),j=[],f,k,m,h;k=0;for(m=e.length;k<m;k++)h=e[k],f=h[0],h[1]&&(h[0]=function(){},j.push(k)),f.apply(this.context,g);k=0;for(m=j.length;k<m;k++)e.splice(j[k],
1)}};this.subscribe=function(a,b,c){this.topics[a]?this.topics[a].push([b,c]):this.topics[a]=[[b,c]];return{topic:a,callback:b}};this.unsubscribe=function(a){if(this.topics[a.topic])for(var b=this.topics[a.topic],c=0,d=b.length;c<d;c++)b[c][0]===a.callback&&b.splice(c,1)}},z=function(a){var i=this.canvasContext,b=a.x[0],a=a.y[0],c=this.settings.lineWidth,d=i.fillStyle;i.fillStyle=i.strokeStyle;i.fillRect(b+c/-2,a+c/-2,c,c);i.fillStyle=d},w=function(a,b){var c=new h(a.x[b-1],a.y[b-1]),d=new h(a.x[b],
a.y[b]),e=c.getVectorToPoint(d);if(1<b){var g=new h(a.x[b-2],a.y[b-2]),j=g.getVectorToPoint(c),k;if(j.getLength()>this.lineCurveThreshold){k=2<b?(new h(a.x[b-3],a.y[b-3])).getVectorToPoint(g):new o(0,0);var f=0.35*j.getLength(),m=j.angleTo(k.reverse()),u=e.angleTo(j.reverse());k=(new o(k.x+j.x,k.y+j.y)).resizeTo(Math.max(0.05,m)*f);var p=(new o(j.x+e.x,j.y+e.y)).reverse().resizeTo(Math.max(0.05,u)*f),j=this.canvasContext,f=g.x,u=g.y,m=c.x,v=c.y,n=g.x+k.x,g=g.y+k.y;k=c.x+p.x;p=c.y+p.y;j.beginPath();
j.moveTo(f,u);j.bezierCurveTo(n,g,k,p,m,v);j.stroke()}}e.getLength()<=this.lineCurveThreshold&&(e=this.canvasContext,g=c.x,c=c.y,k=d.x,d=d.y,e.beginPath(),e.moveTo(g,c),e.lineTo(k,d),e.stroke())},y=function(a){var b=a.x.length-1;if(0<b){var c=new h(a.x[b],a.y[b]),d=new h(a.x[b-1],a.y[b-1]),e=d.getVectorToPoint(c);if(e.getLength()>this.lineCurveThreshold){if(1<b){var a=(new h(a.x[b-2],a.y[b-2])).getVectorToPoint(d),g=(new o(a.x+e.x,a.y+e.y)).resizeTo(e.getLength()/2),e=this.canvasContext,a=d.x,b=d.y,
j=c.x,k=c.y,f=d.x+g.x,d=d.y+g.y,g=c.x,c=c.y;e.beginPath();e.moveTo(a,b);e.bezierCurveTo(f,d,g,c,j,k)}else e=this.canvasContext,a=d.x,d=d.y,b=c.x,c=c.y,e.beginPath(),e.moveTo(a,d),e.lineTo(b,c);e.stroke()}}};n.prototype.resetCanvas=function(a){var b=this.canvas,c=this.settings,d=this.canvasContext,e=this.isCanvasEmulator,g=b.width,j=b.height;d.clearRect(0,0,g+30,j+30);d.shadowColor=d.fillStyle=c["background-color"];e&&d.fillRect(0,0,g+30,j+30);d.lineWidth=Math.ceil(parseInt(c.lineWidth,10));d.lineCap=
d.lineJoin="round";d.strokeStyle=c["decor-color"];d.shadowOffsetX=0;d.shadowOffsetY=0;var k=Math.round(j/5),m=1.5*k,h=j-k,g=g-1.5*k,j=j-k;d.beginPath();d.moveTo(m,h);d.lineTo(g,j);d.stroke();d.strokeStyle=c.color;e||(d.shadowColor=d.strokeStyle,d.shadowOffsetX=0.5*d.lineWidth,d.shadowOffsetY=-0.6*d.lineWidth,d.shadowBlur=0);a||(a=[]);d=this.dataEngine=new s(a,this,z,w,y);c.data=a;$(b).data(f+".data",a).data(f+".settings",c);var u=this.$parent,p=this.events,v=f;d.changed=function(){p.publish(v+".change");
u.trigger("change")};d.changed();return!0};n.prototype.initializeCanvas=function(a){var b=document.createElement("canvas"),c=$(b);a.width===a.height&&"ratio"===a.height&&(a.width="100%");c.css("margin",0).css("padding",0).css("border","none").css("height","ratio"===a.height||!a.height?1:a.height.toString(10)).css("width","ratio"===a.width||!a.width?1:a.width.toString(10));c.appendTo(this.$parent);"ratio"===a.height?c.css("height",Math.round(c.width()/a.sizeRatio)):"ratio"===a.width&&c.css("width",
Math.round(c.height()*a.sizeRatio));c.addClass(f);b.width=c.width();b.height=c.height();a=b;if(a.getContext)a=!1;else if("function"===typeof FlashCanvas)a=FlashCanvas.initElement(a),c=1,window&&(window.screen&&window.screen.deviceXDPI&&window.screen.logicalXDPI)&&(c=1*window.screen.deviceXDPI/window.screen.logicalXDPI),1!==c&&($(a).children("object").get(0).resize(Math.ceil(a.width*c),Math.ceil(a.height*c)),a.getContext("2d").scale(c,c)),a=!0;else throw Error("Canvas element does not support 2d context. jSignature cannot proceed.");
this.isCanvasEmulator=a;b.onselectstart=function(a){a&&a.preventDefault&&a.preventDefault();a&&a.stopPropagation&&a.stopPropagation();return false};return b};var m=function(a,c){var b=new Image,d=this;b.onload=function(){d.getContext("2d").drawImage(b,0,0,b.width<d.width?b.width:d.width,b.height<d.height?b.height:d.height)};b.src="data:"+c+","+a},p=function(a){this.find("canvas."+f).add(this.filter("canvas."+f)).data(f+".this").resetCanvas(a);return this},e=function(a,b){if(void 0===b&&("string"===
typeof a&&"data:"===a.substr(0,5))&&(b=a.slice(5).split(",")[0],a=a.slice(6+b.length),b===a))return;var c=this.find("canvas."+f).add(this.filter("canvas."+f));if(v.hasOwnProperty(b))0!==c.length&&v[b].call(c[0],a,b,function(a){return function(){return a.resetCanvas.apply(a,arguments)}}(c.data(f+".this")));else throw Error(f+" is unable to find import plugin with for format '"+String(b)+"'");return this},b=new x,c=f,d,g=function(){b.publish(c+".parentresized")};$(window).bind("resize."+c,function(){d&&
clearTimeout(d);d=setTimeout(g,500)}).bind("mouseup."+c,function(a){b.publish(c+".windowmouseup",a)});var j={exampleExtension:function(a){this.events.subscribe(f+".initializing",function(){this.settings.hasOwnProperty("non-existent setting category?")&&console.log(a+" is here")})}},u={"default":function(){return this.toDataURL()},"native":function(a){return a},image:function(){var a=this.toDataURL();if("string"===typeof a&&4<a.length&&"data:"===a.slice(0,5)&&-1!==a.indexOf(",")){var b=a.indexOf(",");
return[a.slice(5,b),a.substr(b+1)]}return[]}},v={"native":function(a,b,c){c(a)},image:m,"image/png;base64":m,"image/jpeg;base64":m,"image/jpg;base64":m},k={"export":u,"import":v,instance:j},A={init:function(a){return this.each(function(){new n(this,a,j)})},getSettings:function(){return this.find("canvas."+f).add(this.filter("canvas."+f)).data(f+".this").settings},clear:p,reset:p,addPlugin:function(a,b,c){k.hasOwnProperty(a)&&(k[a][b]=c);return this},listPlugins:function(a){var b=[];if(k.hasOwnProperty(a)){var a=
k[a],c;for(c in a)a.hasOwnProperty(c)&&b.push(c)}return b},getData:function(a){var b=this.find("canvas."+f).add(this.filter("canvas."+f));void 0===a&&(a="default");if(0!==b.length&&u.hasOwnProperty(a))return u[a].call(b.get(0),b.data(f+".data"))},importData:e,setData:e,globalEvents:function(){return b},events:function(){return this.find("canvas."+f).add(this.filter("canvas."+f)).data(f+".this").events}};$.fn[f]=function(a){if(!a||"object"===typeof a)return A.init.apply(this,arguments);if("string"===
typeof a&&A[a])return A[a].apply(this,Array.prototype.slice.call(arguments,1));$.error("Method "+String(a)+" does not exist on jQuery."+f)}})();
(function(){for(var r={},o={},h="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWX".split(""),s=h.length/2,n=s-1;-1<n;n--)r[h[n]]=h[n+s],o[h[n+s]]=h[n];var f=function(f){for(var f=f.split(""),h=f.length,e=1;e<h;e++)f[e]=r[f[e]];return f.join("")},t=function(h){for(var p=[],e=0,b=1,c=h.length,d,g,j=0;j<c;j++)d=Math.round(h[j]),g=d-e,e=d,0>g&&0<b?(b=-1,p.push("Z")):0<g&&0>b&&(b=1,p.push("Y")),d=Math.abs(g),d>=s?p.push(f(d.toString(s))):p.push(d.toString(s));return p.join("")},x=function(f){for(var h=
[],f=f.split(""),e=f.length,b,c=1,d=[],g=0,j=0;j<e;j++)(b=f[j],b in r||"Z"===b||"Y"===b)?(0!==d.length&&(d=parseInt(d.join(""),s)*c+g,h.push(d),g=d),"Z"===b)?(c=-1,d=[]):"Y"===b?(c=1,d=[]):d=[b]:d.push(o[b]);h.push(parseInt(d.join(""),s)*c+g);return h},z=function(f){for(var h=[],e=f.length,b,c=0;c<e;c++)b=f[c],h.push(t(b.x)),h.push(t(b.y));return h.join("_")},w=function(f){for(var h=[],f=f.split("_"),e=f.length/2,b=0;b<e;b++)h.push({x:x(f[2*b]),y:x(f[2*b+1])});return h},h=function(f){return["image/jsignature;base30",
z(f)]},n=function(f,h,e){"string"===typeof f&&("image/jsignature;base30"===f.substring(0,23).toLowerCase()&&(f=f.substring(24)),e(w(f)))};if(null==this.jQuery)throw Error("We need jQuery for some of the functionality. jQuery is not detected. Failing to initialize...");var y=this.jQuery.fn.jSignature;y("addPlugin","export","base30",h);y("addPlugin","export","image/jsignature;base30",h);y("addPlugin","import","base30",n);y("addPlugin","import","image/jsignature;base30",n);this.jSignatureDebug&&(this.jSignatureDebug.base30=
{remapTailChars:f,compressstrokeleg:t,uncompressstrokeleg:x,compressstrokes:z,uncompressstrokes:w,charmap:r})}).call("undefined"!==typeof window?window:this);
(function(){function r(e,b){this.x=e;this.y=b;this.reverse=function(){return new this.constructor(-1*this.x,-1*this.y)};this._length=null;this.getLength=function(){this._length||(this._length=Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)));return this._length};var c=function(b){return Math.round(b/Math.abs(b))};this.resizeTo=function(b){if(0===this.x&&0===this.y)this._length=0;else if(0===this.x)this._length=b,this.y=b*c(this.y);else if(0===this.y)this._length=b,this.x=b*c(this.x);else{var e=Math.abs(this.y/
this.x),j=Math.sqrt(Math.pow(b,2)/(1+Math.pow(e,2))),e=e*j;this._length=b;this.x=j*c(this.x);this.y=e*c(this.y)}return this};this.angleTo=function(b){var c=this.getLength()*b.getLength();return 0===c?0:Math.acos(Math.min(Math.max((this.x*b.x+this.y*b.y)/c,-1),1))/Math.PI}}function o(e,b){this.x=e;this.y=b;this.getVectorToCoordinates=function(b,d){return new r(b-this.x,d-this.y)};this.getVectorFromCoordinates=function(b,d){return this.getVectorToCoordinates(b,d).reverse()};this.getVectorToPoint=function(b){return new r(b.x-
this.x,b.y-this.y)};this.getVectorFromPoint=function(b){return this.getVectorToPoint(b).reverse()}}function h(e,b){var c=Math.pow(10,b);return Math.round(e*c)/c}function s(e,b,c){var b=b+1,d=new o(e.x[b-1],e.y[b-1]),g=new o(e.x[b],e.y[b]),g=d.getVectorToPoint(g),j=new o(e.x[b-2],e.y[b-2]),d=j.getVectorToPoint(d);return d.getLength()>c?(c=2<b?(new o(e.x[b-3],e.y[b-3])).getVectorToPoint(j):new r(0,0),e=0.35*d.getLength(),j=d.angleTo(c.reverse()),b=g.angleTo(d.reverse()),c=(new r(c.x+d.x,c.y+d.y)).resizeTo(Math.max(0.05,
j)*e),g=(new r(d.x+g.x,d.y+g.y)).reverse().resizeTo(Math.max(0.05,b)*e),g=new r(d.x+g.x,d.y+g.y),["c",h(c.x,2),h(c.y,2),h(g.x,2),h(g.y,2),h(d.x,2),h(d.y,2)]):["l",h(d.x,2),h(d.y,2)]}function n(e,b){var c=e.x.length-1,d=new o(e.x[c],e.y[c]),g=new o(e.x[c-1],e.y[c-1]),d=g.getVectorToPoint(d);if(1<c&&d.getLength()>b){var c=(new o(e.x[c-2],e.y[c-2])).getVectorToPoint(g),g=d.angleTo(c.reverse()),j=0.35*d.getLength(),c=(new r(c.x+d.x,c.y+d.y)).resizeTo(Math.max(0.05,g)*j);return["c",h(c.x,2),h(c.y,2),h(d.x,
2),h(d.y,2),h(d.x,2),h(d.y,2)]}return["l",h(d.x,2),h(d.y,2)]}function f(e,b,c){for(var b=["M",h(e.x[0]-b,2),h(e.y[0]-c,2)],c=1,d=e.x.length-1;c<d;c++)b.push.apply(b,s(e,c,1));0<d?b.push.apply(b,n(e,c,1)):0===d&&b.push.apply(b,["l",1,1]);return b.join(" ")}function t(e){var b=['<?xml version="1.0" encoding="UTF-8" standalone="no"?>','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">'],c,d=e.length,g,j=[],h=[],v=g=c=0,k=0,m=[];if(0!==d){for(c=0;c<d;c++){v=
e[c];k=[];g={x:[],y:[]};for(var a=void 0,i=void 0,a=0,i=v.x.length;a<i;a++)k.push({x:v.x[a],y:v.y[a]});k=simplify(k,0.7,!0);a=0;for(i=k.length;a<i;a++)g.x.push(k[a].x),g.y.push(k[a].y);m.push(g);j=j.concat(g.x);h=h.concat(g.y)}e=Math.min.apply(null,j)-1;d=Math.max.apply(null,j)+1;j=Math.min.apply(null,h)-1;h=Math.max.apply(null,h)+1;v=0>e?0:e;k=0>j?0:j;c=d-e;g=h-j}b.push('<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="'+c.toString()+'" height="'+g.toString()+'">');c=0;for(d=m.length;c<
d;c++)g=m[c],b.push('<path fill="none" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="'+f(g,v,k)+'"/>');b.push("</svg>");return b.join("")}function x(e){return[m,t(e)]}function z(e){return[p,y(t(e))]}var w=window;"use strict";("undefined"!=typeof exports?exports:w).simplify=function(e,b,c){b=void 0!==b?b*b:1;if(!c){for(var d=e.length,g,j=e[0],f=[j],c=1;c<d;c++){g=e[c];var h=g.x-j.x,k=g.y-j.y;h*h+k*k>b&&(f.push(g),j=g)}e=(j!==g&&f.push(g),f)}g=e;var c=g.length,
d=new ("undefined"!=typeof Uint8Array?Uint8Array:Array)(c),j=0,f=c-1,m,a,i=[],q=[],l=[];for(d[j]=d[f]=1;f;){k=0;for(h=j+1;h<f;h++){m=g[h];var n=g[j],p=g[f],o=n.x,r=n.y,n=p.x-o,t=p.y-r,s=void 0;if(0!==n||0!==t)s=((m.x-o)*n+(m.y-r)*t)/(n*n+t*t),1<s?(o=p.x,r=p.y):0<s&&(o+=n*s,r+=t*s);m=(n=m.x-o,t=m.y-r,n*n+t*t);m>k&&(a=h,k=m)}k>b&&(d[a]=1,i.push(j),q.push(a),i.push(a),q.push(f));j=i.pop();f=q.pop()}for(h=0;h<c;h++)d[h]&&l.push(g[h]);return e=l,e};if("function"!==typeof y)var y=function(e){var b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".split(""),
c,d,g,f,h=0,m=0,k="",k=[];do c=e.charCodeAt(h++),d=e.charCodeAt(h++),g=e.charCodeAt(h++),f=c<<16|d<<8|g,c=f>>18&63,d=f>>12&63,g=f>>6&63,f&=63,k[m++]=b[c]+b[d]+b[g]+b[f];while(h<e.length);k=k.join("");e=e.length%3;return(e?k.slice(0,e-3):k)+"===".slice(e||3)};var m="image/svg+xml",p="image/svg+xml;base64";if("undefined"===typeof $)throw Error("We need jQuery for some of the functionality. jQuery is not detected. Failing to initialize...");w=$.fn.jSignature;w("addPlugin","export","svg",x);w("addPlugin",
"export",m,x);w("addPlugin","export","svgbase64",z);w("addPlugin","export",p,z)})();
(function(){$.fn.jSignature("addPlugin","instance","UndoButton",function(r){this.events.subscribe("jSignature.attachingEventHandlers",function(){if(this.settings[r]){var o=this.settings[r];"function"!==typeof o&&(o=function(){var f=$('<input type="button" value="Undo last stroke" style="position:absolute;display:none;margin:0 !important;top:auto" />').appendTo(this.$controlbarLower),h=f.width();f.css("left",Math.round((this.canvas.width-h)/2));h!==f.width()&&f.width(h);return f});var h=o.call(this),
s=this;s.events.subscribe("jSignature.change",function(){s.dataEngine.data.length?h.show():h.hide()});var n=this,f=(this.events.topics.hasOwnProperty("jSignature.undo")?r:"jSignature")+".undo";h.bind("click",function(){n.events.publish(f)});n.events.subscribe(f,function(){var f=n.dataEngine.data;f.length&&(f.pop(),n.resetCanvas(f))})}})})})();